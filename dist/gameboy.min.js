!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Gameboy=t()}}(function(){return function t(e,r,n){function i(u,s){if(!r[u]){if(!e[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(o)return o(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=r[u]={exports:{}};e[u][0].call(f.exports,function(t){var r=e[u][1][t];return i(r?r:t)},f,f.exports,t,e,r,n)}return r[u].exports}for(var o="function"==typeof require&&require,u=0;u<n.length;u++)i(n[u]);return i}({1:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var u,s=t[Symbol.iterator]();!(n=(u=s.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=t("debug")("gameboy:cpu"),a=t("debug")("gameboy:cpu:cycle"),f=t("debug")("gameboy:cpu:int"),h=t("raf"),l=t("./opcodes"),p=t("../util/serializable"),_=t("../interrupts"),y=_.INT_40,d=_.INT_48,v=_.INT_50,m=_.INT_58,b=_.INT_60,L=["_mmu","_timer","_lcd","_loop"],w=function(t){function e(t,r,o){n(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u._mmu=t,u._timer=r,u._lcd=o,u._loop=null,u.ime=!1,u._a=0,u._f=0,u._b=0,u._c=0,u._d=0,u._e=0,u._h=0,u._l=0,u._sp=0,u._pc=0,u}return o(e,t),s(e,[{key:"init",value:function(){this.ime=!1,this._a=0,this._f=0,this._b=0,this._c=0,this._d=0,this._e=0,this._h=0,this._l=0,this._sp=0,this._pc=0}},{key:"start",value:function(){var t=this;c("start");var e=function e(){t._step(),t._loop=h(e)};this._loop=h(e)}},{key:"stop",value:function(){c("stop"),h.cancel(this._loop)}},{key:"_step",value:function(){for(var t=0,e=0;t<70224;){var r=this._runCycle()+e;this._timer.step(r),this._lcd.step(r),e=this._handleInterrupts(),t+=r}}},{key:"_runCycle",value:function(){var t=this._mmu.readByte(this._pc),e=l.$;203==t&&(t=this._mmu.readByte(this._pc+1),e=l.$[203]);var r=u(e[t],2),n=r[0],i=r[1];return a("%s; $%s",n,this._pc.toString(16)),i(this,this._mmu)}},{key:"_handleInterrupts",value:function(){if(!this.ime)return 0;var t=this._mmu.ie&this._mmu.if;if(0==t)return 0;f("flags 0b%s",t.toString(2));var e=void 0;return t&y?(this._mmu.if&=~y,e=64):t&d?(this._mmu.if&=~d,e=72):t&v?(this._mmu.if&=~v,e=80):t&m?(this._mmu.if&=~m,e=88):t&b&&(this._mmu.if&=~b,e=96),this.ime=!1,this._mmu.writeWord(this._sp-=2,this._pc),this._pc=e,16}},{key:"a",get:function(){return this._a},set:function(t){this._a=255&t}},{key:"f",get:function(){return this._f},set:function(t){this._f=240&t}},{key:"b",get:function(){return this._b},set:function(t){this._b=255&t}},{key:"c",get:function(){return this._c},set:function(t){this._c=255&t}},{key:"d",get:function(){return this._d},set:function(t){this._d=255&t}},{key:"e",get:function(){return this._e},set:function(t){this._e=255&t}},{key:"h",get:function(){return this._h},set:function(t){this._h=255&t}},{key:"l",get:function(){return this._l},set:function(t){this._l=255&t}},{key:"af",get:function(){return this._a<<8|this._f},set:function(t){this.a=t>>8,this.f=t}},{key:"bc",get:function(){return this._b<<8|this._c},set:function(t){this.b=t>>8,this.c=t}},{key:"de",get:function(){return this._d<<8|this._e},set:function(t){this.d=t>>8,this.e=t}},{key:"hl",get:function(){return this._h<<8|this._l},set:function(t){this.h=t>>8,this.l=t}},{key:"sp",get:function(){return this._sp},set:function(t){this._sp=65535&t}},{key:"pc",get:function(){return this._pc},set:function(t){this._pc=65535&t}}]),e}(p({exclude:L}));e.exports=w},{"../interrupts":8,"../util/serializable":16,"./opcodes":2,debug:14,raf:21}],2:[function(t,e,r){"use strict";function n(t,e){var r=e.readByte(t.pc+1).signed(),n=t.sp+r,i=t.sp^r^n;return t.f=0,0!=(16&i)&&(t.f|=A),0!=(256&i)&&(t.f|=T),n}function i(t,e){var r=t.a+e;return t.f=0,0==(255&r)&&(t.f|=g),0!=(16&(t.a^e^r))&&(t.f|=A),0!=(256&r)&&(t.f|=T),r}function o(t,e){var r=t.f>>4&1,n=t.a+e+r;return t.f=0,0==(255&n)&&(t.f|=g),0!=(16&(t.a^e^n))&&(t.f|=A),0!=(256&n)&&(t.f|=T),n}function u(t,e){var r=t.a-e;return t.f=D,0==(255&r)&&(t.f|=g),0!=(16&(t.a^e^r))&&(t.f|=A),0!=(256&r)&&(t.f|=T),r}function s(t,e){var r=t.f>>4&1,n=t.a-e-r;return t.f=D,0==(255&n)&&(t.f|=g),0!=(16&(t.a^e^n))&&(t.f|=A),0!=(256&n)&&(t.f|=T),n}function c(t,e){var r=t.a&e;return t.f=A,0==(255&r)&&(t.f|=g),r}function a(t,e){var r=t.a|e;return t.f=0,0==(255&r)&&(t.f|=g),r}function f(t,e){var r=t.a^e;return t.f=0,0==(255&r)&&(t.f|=g),r}function h(t,e){var r=e+1;return t.f&=-225,0==(255&r)&&(t.f|=g),15==(15&e)&&(t.f|=A),r}function l(t,e){var r=e-1;return t.f&=-225,0==(255&r)&&(t.f|=g),t.f|=D,0==(15&e)&&(t.f|=A),r}function p(t,e){var r=e<<4|e>>4;return t.f=0,0==(255&r)&&(t.f|=g),r}function _(t,e){var r=e<<1|e>>7;return t.f=0,0==(255&r)&&(t.f|=g),0!=(128&e)&&(t.f|=T),r}function y(t,e){var r=t.f>>4&1,n=e<<1|r;return t.f=0,0==(255&n)&&(t.f|=g),0!=(128&e)&&(t.f|=T),n}function d(t,e){var r=e>>1|e<<7;return t.f=0,0==(255&r)&&(t.f|=g),0!=(1&e)&&(t.f|=T),r}function v(t,e){var r=t.f>>4&1,n=r<<7|e>>1;return t.f=0,0==(255&n)&&(t.f|=g),0!=(1&e)&&(t.f|=T),n}function m(t,e){var r=e<<1;return t.f=0,0==(255&r)&&(t.f|=g),0!=(128&e)&&(t.f|=T),r}function b(t,e){var r=128&e|e>>1;return t.f=0,0==(255&r)&&(t.f|=g),0!=(1&e)&&(t.f|=T),r}function L(t,e){var r=e>>1;return t.f=0,0==(255&r)&&(t.f|=g),0!=(1&e)&&(t.f|=T),r}function w(t,e,r){var n=r&1<<e;return t.f&=-225,0==n&&(t.f|=g),t.f|=A,n}t("../util/number");var B=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(e,r){var n=r.readByte(e.pc),i=""+t.toString(16)+n.toString(16),o=e.pc.toString(16);throw new Error("unknown opcode 0x"+i+"; $"+o)}},E=r.$=new Array(255).fill([null,B()]),S=E[203]=new Array(255).fill([null,B(203)]),g=128,D=64,A=32,T=16,C=function(t){return function(e,r){return e[t]=r.readByte(e.pc+1),e.pc+=2,8}};E[6]=["LD B,n",C("b")],E[14]=["LD C,n",C("c")],E[22]=["LD D,n",C("d")],E[30]=["LD E,n",C("e")],E[38]=["LD H,n",C("h")],E[46]=["LD L,n",C("l")];var R=function(t,e){return function(r){return r[t]=r[e],r.pc+=1,4}};E[120]=["LD A,B",R("a","b")],E[121]=["LD A,C",R("a","c")],E[122]=["LD A,D",R("a","d")],E[123]=["LD A,E",R("a","e")],E[124]=["LD A,H",R("a","h")],E[125]=["LD A,L",R("a","l")],E[127]=["LD A,A",R("a","a")],E[64]=["LD B,B",R("b","b")],E[65]=["LD B,C",R("b","c")],E[66]=["LD B,D",R("b","d")],E[67]=["LD B,E",R("b","e")],E[68]=["LD B,H",R("b","h")],E[69]=["LD B,L",R("b","l")],E[72]=["LD C,B",R("c","b")],E[73]=["LD C,C",R("c","c")],E[74]=["LD C,D",R("c","d")],E[75]=["LD C,E",R("c","e")],E[76]=["LD C,H",R("c","h")],E[77]=["LD C,L",R("c","l")],E[80]=["LD D,B",R("d","b")],E[81]=["LD D,C",R("d","c")],E[82]=["LD D,D",R("d","d")],E[83]=["LD D,E",R("d","e")],E[84]=["LD D,H",R("d","h")],E[85]=["LD D,L",R("d","l")],E[88]=["LD E,B",R("e","b")],E[89]=["LD E,C",R("e","c")],E[90]=["LD E,D",R("e","d")],E[91]=["LD E,E",R("e","e")],E[92]=["LD E,H",R("e","h")],E[93]=["LD E,L",R("e","l")],E[96]=["LD H,B",R("h","b")],E[97]=["LD H,C",R("h","c")],E[98]=["LD H,D",R("h","d")],E[99]=["LD H,E",R("h","e")],E[100]=["LD H,H",R("h","h")],E[101]=["LD H,L",R("h","l")],E[104]=["LD L,B",R("l","b")],E[105]=["LD L,C",R("l","c")],E[106]=["LD L,D",R("l","d")],E[107]=["LD L,E",R("l","e")],E[108]=["LD L,H",R("l","h")],E[109]=["LD L,L",R("l","l")];var H=function(t){return function(e,r){return e[t]=r.readByte(e.hl),e.pc+=1,8}};E[70]=["LD B,(HL)",H("b")],E[78]=["LD C,(HL)",H("c")],E[86]=["LD D,(HL)",H("d")],E[94]=["LD E,(HL)",H("e")],E[102]=["LD H,(HL)",H("h")],E[110]=["LD L,(HL)",H("l")],E[126]=["LD A,(HL)",H("a")];var O=function(t){return function(e,r){return r.writeByte(e.hl,e[t]),e.pc+=1,8}};E[112]=["LD (HL),B",O("b")],E[113]=["LD (HL),C",O("c")],E[114]=["LD (HL),D",O("d")],E[115]=["LD (HL),E",O("e")],E[116]=["LD (HL),H",O("h")],E[117]=["LD (HL),L",O("l")],E[54]=["LD (HL),n",function(t,e){return e.writeByte(t.hl,e.readByte(t.pc+1)),t.pc+=2,12}];var k=function(t){return function(e){return e.a=e[t],e.pc+=1,4}};E[120]=["LD A,B",k("b")],E[121]=["LD A,C",k("c")],E[122]=["LD A,D",k("d")],E[123]=["LD A,E",k("e")],E[124]=["LD A,H",k("h")],E[125]=["LD A,L",k("l")],E[127]=["LD A,A",k("a")];var I=function(t){return function(e,r){return e.a=r.readByte(e[t]),e.pc+=1,8}};E[10]=["LD A,(BC)",I("bc")],E[26]=["LD A,(DE)",I("de")],E[126]=["LD A,(HL)",I("hl")],E[250]=["LD A,(nn)",function(t,e){return t.a=e.readByte(e.readWord(t.pc+1)),t.pc+=3,16}],E[62]=["LD A,n",function(t,e){return t.a=e.readByte(t.pc+1),t.pc+=2,8}];var P=function(t){return function(e){return e[t]=e.a,e.pc+=1,4}};E[71]=["LD B,A",P("b")],E[79]=["LD C,A",P("c")],E[87]=["LD D,A",P("d")],E[95]=["LD E,A",P("e")],E[103]=["LD H,A",P("h")],E[111]=["LD L,A",P("l")],E[127]=["LD A,A",P("a")];var j=function(t){return function(e,r){return r.writeByte(e[t],e.a),e.pc+=1,8}};E[2]=["LD (BC),A",j("bc")],E[18]=["LD (DE),A",j("de")],E[119]=["LD (HL),A",j("hl")],E[234]=["LD (nn),A",function(t,e){return e.writeByte(e.readWord(t.pc+1),t.a),t.pc+=3,16}],E[242]=["LD A,(C)",function(t,e){return t.a=e.readByte(65280+t.c),t.pc+=1,8}],E[226]=["LD (C),A",function(t,e){return e.writeByte(65280+t.c,t.a),t.pc+=1,8}],E[58]=["LD A,(HL-)",function(t,e){return t.a=e.readByte(t.hl--),t.pc+=1,8}],E[50]=["LD (HL-),A",function(t,e){return e.writeByte(t.hl--,t.a),t.pc+=1,8}],E[42]=["LD A,(HL+)",function(t,e){return t.a=e.readByte(t.hl++),t.pc+=1,8}],E[34]=["LD (HL+),A",function(t,e){return e.writeByte(t.hl++,t.a),t.pc+=1,8}],E[224]=["LDH (n),A",function(t,e){var r=e.readByte(t.pc+1);return e.writeByte(65280+r,t.a),t.pc+=2,12}],E[240]=["LDH A,(n)",function(t,e){var r=e.readByte(t.pc+1);return t.a=e.readByte(65280+r),t.pc+=2,12}];var x=function(t){return function(e,r){return e[t]=r.readWord(e.pc+1),e.pc+=3,12}};E[1]=["LD BC,nn",x("bc")],E[17]=["LD DE,nn",x("de")],E[33]=["LD HL,nn",x("hl")],E[49]=["LD SP,nn",x("sp")],E[249]=["LD SP,HL",function(t){return t.sp=t.hl,t.pc+=1,8}],E[248]=["LD HL,SP+n",function(t,e){return t.hl=n(t,e),t.pc+=2,12}],E[8]=["LD (nn),SP",function(t,e){return e.writeWord(e.readWord(t.pc+1),t.sp),t.pc+=3,20}];var N=function(t){return function(e,r){return r.writeWord(e.sp-=2,e[t]),e.pc+=1,16}};E[197]=["PUSH BC",N("bc")],E[213]=["PUSH DE",N("de")],E[229]=["PUSH HL",N("hl")],E[245]=["PUSH AF",N("af")];var U=function(t){return function(e,r){return e[t]=r.readWord(e.sp),e.sp+=2,e.pc+=1,12}};E[193]=["POP BC",U("bc")],E[209]=["POP DE",U("de")],E[225]=["POP HL",U("hl")],E[241]=["POP AF",U("af")];var W=function(t){return function(e){return e.a=i(e,e[t]),e.pc+=1,4}};E[128]=["ADD A,B",W("b")],E[129]=["ADD A,C",W("c")],E[130]=["ADD A,D",W("d")],E[131]=["ADD A,E",W("e")],E[132]=["ADD A,H",W("h")],E[133]=["ADD A,L",W("l")],E[135]=["ADD A,A",W("a")],E[134]=["ADD A,(HL)",function(t,e){var r=e.readByte(t.hl);return t.a=i(t,r),t.pc+=1,8}],E[198]=["ADD A,#",function(t,e){var r=e.readByte(t.pc+1);return t.a=i(t,r),t.pc+=2,8}];var M=function(t){return function(e){return e.a=o(e,e[t]),e.pc+=1,4}};E[136]=["ADC A,B",M("b")],E[137]=["ADC A,C",M("c")],E[138]=["ADC A,D",M("d")],E[139]=["ADC A,E",M("e")],E[140]=["ADC A,H",M("h")],E[141]=["ADC A,L",M("l")],E[143]=["ADC A,A",M("a")],E[142]=["ADC A,(HL)",function(t,e){return t.a=o(t,e.readByte(t.hl)),t.pc+=1,8}],E[206]=["ADC A,#",function(t,e){return t.a=o(t,e.readByte(t.pc+1)),t.pc+=2,8}];var z=function(t){return function(e){return e.a=u(e,e[t]),e.pc+=1,4}};E[144]=["SUB B",z("b")],E[145]=["SUB C",z("c")],E[146]=["SUB D",z("d")],E[147]=["SUB E",z("e")],E[148]=["SUB H",z("h")],E[149]=["SUB L",z("l")],E[151]=["SUB A",z("a")],E[150]=["SUB (HL)",function(t,e){return t.a=u(t,e.readByte(t.hl)),t.pc+=1,8}],E[214]=["SUB #",function(t,e){return t.a=u(t,e.readByte(t.pc+1)),t.pc+=2,8}];var J=function(t){return function(e){return e.a=s(e,e[t]),e.pc+=1,4}};E[152]=["SBC A,B",J("b")],E[153]=["SBC A,C",J("c")],E[154]=["SBC A,D",J("d")],E[155]=["SBC A,E",J("e")],E[156]=["SBC A,H",J("h")],E[157]=["SBC A,L",J("l")],E[159]=["SBC A,A",J("a")],E[158]=["SBC A,(HL)",function(t,e){return t.a=s(t,e.readByte(t.hl)),t.pc+=1,8}],E[222]=["SBC A,#",function(t,e){return t.a=s(t,e.readByte(t.pc+1)),t.pc+=2,8}];var F=function(t){return function(e){return e.a=c(e,e[t]),e.pc+=1,4}};E[160]=["AND B",F("b")],E[161]=["AND C",F("c")],E[162]=["AND D",F("d")],E[163]=["AND E",F("e")],E[164]=["AND H",F("h")],E[165]=["AND L",F("l")],E[167]=["AND A",F("a")],E[166]=["AND (HL)",function(t,e){return t.a=c(t,e.readByte(t.hl)),t.pc+=1,8}],E[230]=["AND #",function(t,e){return t.a=c(t,e.readByte(t.pc+1)),t.pc+=2,8}];var X=function(t){return function(e){return e.a=a(e,e[t]),e.pc+=1,4}};E[176]=["OR B",X("b")],E[177]=["OR C",X("c")],E[178]=["OR D",X("d")],E[179]=["OR E",X("e")],E[180]=["OR H",X("h")],E[181]=["OR L",X("l")],E[183]=["OR A",X("a")],E[182]=["OR (HL)",function(t,e){return t.a=a(t,e.readByte(t.hl)),t.pc+=1,4}],E[246]=["OR #",function(t,e){return t.a=a(t,e.readByte(t.pc+1)),t.pc+=2,4}];var Y=function(t){return function(e){return e.a=f(e,e[t]),e.pc+=1,4}};E[168]=["XOR B",Y("b")],E[169]=["XOR C",Y("c")],E[170]=["XOR D",Y("d")],E[171]=["XOR E",Y("e")],E[172]=["XOR H",Y("h")],E[173]=["XOR L",Y("l")],E[175]=["XOR A",Y("a")],E[174]=["XOR (HL)",function(t,e){return t.a=f(t,e.readByte(t.hl)),t.pc+=1,8}],E[238]=["XOR #",function(t,e){return t.a=f(t,e.readByte(t.pc+1)),t.pc+=2,8}];var q=function(t){return function(e){return u(e,e[t]),e.pc+=1,4}};E[184]=["CP B",q("b")],E[185]=["CP C",q("c")],E[186]=["CP D",q("d")],E[187]=["CP E",q("e")],E[188]=["CP H",q("h")],E[189]=["CP L",q("l")],E[191]=["CP A",q("a")],E[190]=["CP (HL)",function(t,e){return u(t,e.readByte(t.hl)),t.pc+=1,8}],E[254]=["CP #",function(t,e){return u(t,e.readByte(t.pc+1)),t.pc+=2,8}];var Z=function(t){return function(e){return e[t]=h(e,e[t]),e.pc+=1,4}};E[4]=["INC B",Z("b")],E[12]=["INC C",Z("c")],E[20]=["INC D",Z("d")],E[28]=["INC E",Z("e")],E[36]=["INC H",Z("h")],E[44]=["INC L",Z("l")],E[60]=["INC A",Z("a")],E[52]=["INC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,h(t,r)),t.pc+=1,12}];var $=function(t){return function(e){return e[t]=l(e,e[t]),e.pc+=1,4}};E[5]=["DEC B",$("b")],E[13]=["DEC C",$("c")],E[21]=["DEC D",$("d")],E[29]=["DEC E",$("e")],E[37]=["DEC H",$("h")],E[45]=["DEC L",$("l")],E[61]=["DEC A",$("a")],E[53]=["DEC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,l(t,r)),t.pc+=1,12}];var G=function(t){return function(e,r){var n=e.hl+e[t];return e.f&=-113,0!=(4096&(e.hl^e[t]^n))&&(e.f|=A),0!=(65536&n)&&(e.f|=T),e.hl=n,e.pc+=1,8}};E[9]=["ADD HL,BC",G("bc")],E[25]=["ADD HL,DE",G("de")],E[41]=["ADD HL,HL",G("hl")],E[57]=["ADD HL,SP",G("sp")],E[232]=["ADD SP,#",function(t,e){return t.sp=n(t,e),t.pc+=2,16}];var V=function(t){return function(e){return e[t]++,e.pc+=1,8}};E[3]=["INC BC",V("bc")],E[19]=["INC DE",V("de")],E[35]=["INC HL",V("hl")],E[51]=["INC SP",V("sp")];var K=function(t){return function(e){return e[t]--,e.pc+=1,8}};E[11]=["DEC BC",K("bc")],E[27]=["DEC DE",K("de")],E[43]=["DEC HL",K("hl")],E[59]=["DEC SP",K("sp")];var Q=function(t){return function(e){return e[t]=p(e,e[t]),e.pc+=2,8}};S[48]=["SWAP B",Q("b")],S[49]=["SWAP C",Q("c")],S[50]=["SWAP D",Q("d")],S[51]=["SWAP E",Q("e")],S[52]=["SWAP H",Q("h")],S[53]=["SWAP L",Q("l")],S[55]=["SWAP A",Q("a")],S[54]=["SWAP (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,p(t,r)),t.pc+=2,16}],E[39]=["DAA",function(t){var e=void 0,r=0;return t.f&A&&(r|=6),t.f&T&&(r|=96),t.f&D?e=t.a-r:((15&t.a)>9&&(r|=6),t.a>153&&(r|=96),e=t.a+r),t.f&=-177,0==(255&e)&&(t.f|=g),0!=(96&r)&&(t.f|=T),t.a=e,t.pc+=1,4}],E[47]=["CPL",function(t){return t.a^=255,t.f|=96,t.pc+=1,4}],E[63]=["CCF",function(t){return t.f&=-97,t.f^=T,t.pc+=1,4}],E[55]=["SCF",function(t){return t.f&=-97,t.f|=T,t.pc+=1,4}],E[0]=["NOP",function(t){return t.pc+=1,4}],E[118]=["HALT",function(t){return t.pc+=1,4}],E[16]=["STOP",function(t){return t.pc+=2,4}],E[243]=["DI",function(t){return t.ime=!1,t.pc+=1,4}],E[251]=["EI",function(t){return t.ime=!0,t.pc+=1,4}],E[7]=["RLCA",function(t){var e=t.a>>7;return t.f=0,0!=e&&(t.f|=T),t.a=t.a<<1|e,t.pc+=1,4}],E[23]=["RLA",function(t){var e=t.a>>7,r=t.f>>4&1;return t.f=0,0!=e&&(t.f|=T),t.a=t.a<<1|r,t.pc+=1,4}],E[15]=["RRCA",function(t){var e=1&t.a;return t.f=0,0!=e&&(t.f|=T),t.a=t.a>>1|e<<7,t.pc+=1,4}],E[31]=["RRA",function(t){var e=1&t.a,r=t.f>>4&1;return t.f=0,0!=e&&(t.f|=T),t.a=t.a>>1|r<<7,t.pc+=1,4}];var tt=function(t){return function(e){return e[t]=_(e,e[t]),e.pc+=2,8}};S[0]=["RLC B",tt("b")],S[1]=["RLC C",tt("c")],S[2]=["RLC D",tt("d")],S[3]=["RLC E",tt("e")],S[4]=["RLC H",tt("h")],S[5]=["RLC L",tt("l")],S[7]=["RLC A",tt("a")],S[6]=["RLC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,_(t,r)),t.pc+=2,16}];var et=function(t){return function(e){return e[t]=y(e,e[t]),e.pc+=2,8}};S[16]=["RL B",et("b")],S[17]=["RL C",et("c")],S[18]=["RL D",et("d")],S[19]=["RL E",et("e")],S[20]=["RL H",et("h")],S[21]=["RL L",et("l")],S[23]=["RL A",et("a")],S[22]=["RL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,y(t,r)),t.pc+=2,16}];var rt=function(t){return function(e){return e[t]=d(e,e[t]),e.pc+=2,8}};S[8]=["RRC B",rt("b")],S[9]=["RRC C",rt("c")],S[10]=["RRC D",rt("d")],S[11]=["RRC E",rt("e")],S[12]=["RRC H",rt("h")],S[13]=["RRC L",rt("l")],S[15]=["RRC A",rt("a")],S[14]=["RRC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,d(t,r)),t.pc+=2,16}];var nt=function(t){return function(e){return e[t]=v(e,e[t]),e.pc+=2,8}};S[24]=["RR B",nt("b")],S[25]=["RR C",nt("c")],S[26]=["RR D",nt("d")],S[27]=["RR E",nt("e")],S[28]=["RR H",nt("h")],S[29]=["RR L",nt("l")],S[31]=["RR A",nt("a")],S[30]=["RR (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,v(t,r)),t.pc+=2,16}];var it=function(t){return function(e){return e[t]=m(e,e[t]),e.pc+=2,8}};S[32]=["SLA B",it("b")],S[33]=["SLA C",it("c")],S[34]=["SLA D",it("d")],S[35]=["SLA E",it("e")],S[36]=["SLA H",it("h")],S[37]=["SLA L",it("l")],S[39]=["SLA A",it("a")],S[38]=["SLA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,m(t,r)),t.pc+=2,16}];var ot=function(t){return function(e){return e[t]=b(e,e[t]),e.pc+=2,8}};S[40]=["SRA B",ot("b")],S[41]=["SRA C",ot("c")],S[42]=["SRA D",ot("d")],S[43]=["SRA E",ot("e")],S[44]=["SRA H",ot("h")],S[45]=["SRA L",ot("l")],S[47]=["SRA A",ot("a")],S[46]=["SRA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,b(t,r)),t.pc+=2,16}];var ut=function(t){return function(e){return e[t]=L(e,e[t]),e.pc+=2,8}};S[56]=["SRL B",ut("b")],S[57]=["SRL C",ut("c")],S[58]=["SRL D",ut("d")],S[59]=["SRL E",ut("e")],S[60]=["SRL H",ut("h")],S[61]=["SRL L",ut("l")],S[63]=["SRL A",ut("a")],S[62]=["SRL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,L(t,r)),t.pc+=2,16}];var st=function(t,e){return function(r){return w(r,t,r[e]),r.pc+=2,8}};S[64]=["BIT 0,B",st(0,"b")],S[65]=["BIT 0,C",st(0,"c")],S[66]=["BIT 0,D",st(0,"d")],S[67]=["BIT 0,E",st(0,"e")],S[68]=["BIT 0,H",st(0,"h")],S[69]=["BIT 0,L",st(0,"l")],S[71]=["BIT 0,A",st(0,"a")],S[72]=["BIT 1,B",st(1,"b")],S[73]=["BIT 1,C",st(1,"c")],S[74]=["BIT 1,D",st(1,"d")],S[75]=["BIT 1,E",st(1,"e")],S[76]=["BIT 1,H",st(1,"h")],S[77]=["BIT 1,L",st(1,"l")],S[79]=["BIT 1,A",st(1,"a")],S[80]=["BIT 2,B",st(2,"b")],S[81]=["BIT 2,C",st(2,"c")],S[82]=["BIT 2,D",st(2,"d")],S[83]=["BIT 2,E",st(2,"e")],S[84]=["BIT 2,H",st(2,"h")],S[85]=["BIT 2,L",st(2,"l")],S[87]=["BIT 2,A",st(2,"a")],S[88]=["BIT 3,B",st(3,"b")],S[89]=["BIT 3,C",st(3,"c")],S[90]=["BIT 3,D",st(3,"d")],S[91]=["BIT 3,E",st(3,"e")],S[92]=["BIT 3,H",st(3,"h")],S[93]=["BIT 3,L",st(3,"l")],S[95]=["BIT 3,A",st(3,"a")],S[96]=["BIT 4,B",st(4,"b")],S[97]=["BIT 4,C",st(4,"c")],S[98]=["BIT 4,D",st(4,"d")],S[99]=["BIT 4,E",st(4,"e")],S[100]=["BIT 4,H",st(4,"h")],S[101]=["BIT 4,L",st(4,"l")],S[103]=["BIT 4,A",st(4,"a")],S[104]=["BIT 5,B",st(5,"b")],S[105]=["BIT 5,C",st(5,"c")],S[106]=["BIT 5,D",st(5,"d")],S[107]=["BIT 5,E",st(5,"e")],S[108]=["BIT 5,H",st(5,"h")],S[109]=["BIT 5,L",st(5,"l")],S[111]=["BIT 5,A",st(5,"a")],S[112]=["BIT 6,B",st(6,"b")],S[113]=["BIT 6,C",st(6,"c")],S[114]=["BIT 6,D",st(6,"d")],S[115]=["BIT 6,E",st(6,"e")],S[116]=["BIT 6,H",st(6,"h")],S[117]=["BIT 6,L",st(6,"l")],S[119]=["BIT 6,A",st(6,"a")],S[120]=["BIT 7,B",st(7,"b")],S[121]=["BIT 7,C",st(7,"c")],S[122]=["BIT 7,D",st(7,"d")],S[123]=["BIT 7,E",st(7,"e")],S[124]=["BIT 7,H",st(7,"h")],S[125]=["BIT 7,L",st(7,"l")],S[127]=["BIT 7,A",st(7,"a")];var ct=function(t){return function(e,r){return w(e,t,r.readByte(e.hl)),e.pc+=2,16}};S[70]=["BIT 0,(HL)",ct(0)],S[78]=["BIT 1,(HL)",ct(1)],S[86]=["BIT 2,(HL)",ct(2)],S[94]=["BIT 3,(HL)",ct(3)],S[102]=["BIT 4,(HL)",ct(4)],S[110]=["BIT 5,(HL)",ct(5)],S[118]=["BIT 6,(HL)",ct(6)],S[126]=["BIT 7,(HL)",ct(7)];var at=function(t,e){return function(r){return r[e]|=1<<t,r.pc+=2,8}};S[192]=["SET 0,B",at(0,"b")],S[193]=["SET 0,C",at(0,"c")],S[194]=["SET 0,D",at(0,"d")],S[195]=["SET 0,E",at(0,"e")],S[196]=["SET 0,H",at(0,"h")],S[197]=["SET 0,L",at(0,"l")],S[199]=["SET 0,A",at(0,"a")],S[200]=["SET 1,B",at(1,"b")],S[201]=["SET 1,C",at(1,"c")],S[202]=["SET 1,D",at(1,"d")],S[203]=["SET 1,E",at(1,"e")],S[204]=["SET 1,H",at(1,"h")],S[205]=["SET 1,L",at(1,"l")],S[207]=["SET 1,A",at(1,"a")],S[208]=["SET 2,B",at(2,"b")],S[209]=["SET 2,C",at(2,"c")],S[210]=["SET 2,D",at(2,"d")],S[211]=["SET 2,E",at(2,"e")],S[212]=["SET 2,H",at(2,"h")],S[213]=["SET 2,L",at(2,"l")],S[215]=["SET 2,A",at(2,"a")],S[216]=["SET 3,B",at(3,"b")],S[217]=["SET 3,C",at(3,"c")],S[218]=["SET 3,D",at(3,"d")],S[219]=["SET 3,E",at(3,"e")],S[220]=["SET 3,H",at(3,"h")],S[221]=["SET 3,L",at(3,"l")],S[223]=["SET 3,A",at(3,"a")],S[224]=["SET 4,B",at(4,"b")],S[225]=["SET 4,C",at(4,"c")],S[226]=["SET 4,D",at(4,"d")],S[227]=["SET 4,E",at(4,"e")],S[228]=["SET 4,H",at(4,"h")],S[229]=["SET 4,L",at(4,"l")],S[231]=["SET 4,A",at(4,"a")],S[232]=["SET 5,B",at(5,"b")],S[233]=["SET 5,C",at(5,"c")],S[234]=["SET 5,D",at(5,"d")],S[235]=["SET 5,E",at(5,"e")],S[236]=["SET 5,H",at(5,"h")],S[237]=["SET 5,L",at(5,"l")],S[239]=["SET 5,A",at(5,"a")],S[240]=["SET 6,B",at(6,"b")],S[241]=["SET 6,C",at(6,"c")],S[242]=["SET 6,D",at(6,"d")],S[243]=["SET 6,E",at(6,"e")],S[244]=["SET 6,H",at(6,"h")],S[245]=["SET 6,L",at(6,"l")],S[247]=["SET 6,A",at(6,"a")],S[248]=["SET 7,B",at(7,"b")],S[249]=["SET 7,C",at(7,"c")],S[250]=["SET 7,D",at(7,"d")],S[251]=["SET 7,E",at(7,"e")],S[252]=["SET 7,H",at(7,"h")],S[253]=["SET 7,L",at(7,"l")],S[255]=["SET 7,A",at(7,"a")];var ft=function(t){return function(e,r){return r.writeByte(e.hl,r.readByte(e.hl)|1<<t),e.pc+=2,16}};S[198]=["SET 0,(HL)",ft(0)],S[206]=["SET 1,(HL)",ft(1)],S[214]=["SET 2,(HL)",ft(2)],S[222]=["SET 3,(HL)",ft(3)],S[230]=["SET 4,(HL)",ft(4)],S[238]=["SET 5,(HL)",ft(5)],S[246]=["SET 6,(HL)",ft(6)],S[254]=["SET 7,(HL)",ft(7)];var ht=function(t,e){return function(r){return r[e]&=~(1<<t),r.pc+=2,8}};S[128]=["RES 0,B",ht(0,"b")],S[129]=["RES 0,C",ht(0,"c")],S[130]=["RES 0,D",ht(0,"d")],S[131]=["RES 0,E",ht(0,"e")],S[132]=["RES 0,H",ht(0,"h")],S[133]=["RES 0,L",ht(0,"l")],S[135]=["RES 0,A",ht(0,"a")],S[136]=["RES 1,B",ht(1,"b")],S[137]=["RES 1,C",ht(1,"c")],S[138]=["RES 1,D",ht(1,"d")],S[139]=["RES 1,E",ht(1,"e")],S[140]=["RES 1,H",ht(1,"h")],S[141]=["RES 1,L",ht(1,"l")],S[143]=["RES 1,A",ht(1,"a")],S[144]=["RES 2,B",ht(2,"b")],S[145]=["RES 2,C",ht(2,"c")],S[146]=["RES 2,D",ht(2,"d")],S[147]=["RES 2,E",ht(2,"e")],S[148]=["RES 2,H",ht(2,"h")],S[149]=["RES 2,L",ht(2,"l")],S[151]=["RES 2,A",ht(2,"a")],S[152]=["RES 3,B",ht(3,"b")],S[153]=["RES 3,C",ht(3,"c")],S[154]=["RES 3,D",ht(3,"d")],S[155]=["RES 3,E",ht(3,"e")],S[156]=["RES 3,H",ht(3,"h")],S[157]=["RES 3,L",ht(3,"l")],S[159]=["RES 3,A",ht(3,"a")],S[160]=["RES 4,B",ht(4,"b")],S[161]=["RES 4,C",ht(4,"c")],S[162]=["RES 4,D",ht(4,"d")],S[163]=["RES 4,E",ht(4,"e")],S[164]=["RES 4,H",ht(4,"h")],S[165]=["RES 4,L",ht(4,"l")],S[167]=["RES 4,A",ht(4,"a")],S[168]=["RES 5,B",ht(5,"b")],S[169]=["RES 5,C",ht(5,"c")],S[170]=["RES 5,D",ht(5,"d")],S[171]=["RES 5,E",ht(5,"e")],S[172]=["RES 5,H",ht(5,"h")],S[173]=["RES 5,L",ht(5,"l")],S[175]=["RES 5,A",ht(5,"a")],S[176]=["RES 6,B",ht(6,"b")],S[177]=["RES 6,C",ht(6,"c")],S[178]=["RES 6,D",ht(6,"d")],S[179]=["RES 6,E",ht(6,"e")],S[180]=["RES 6,H",ht(6,"h")],S[181]=["RES 6,L",ht(6,"l")],S[183]=["RES 6,A",ht(6,"a")],S[184]=["RES 7,B",ht(7,"b")],S[185]=["RES 7,C",ht(7,"c")],S[186]=["RES 7,D",ht(7,"d")],S[187]=["RES 7,E",ht(7,"e")],S[188]=["RES 7,H",ht(7,"h")],S[189]=["RES 7,L",ht(7,"l")],S[191]=["RES 7,A",ht(7,"a")];var lt=function(t){return function(e,r){return r.writeByte(e.hl,r.readByte(e.hl)&~(1<<t)),e.pc+=2,16}};S[134]=["RES 0,(HL)",lt(0)],S[142]=["RES 1,(HL)",lt(1)],S[150]=["RES 2,(HL)",lt(2)],S[158]=["RES 3,(HL)",lt(3)],S[166]=["RES 4,(HL)",lt(4)],S[174]=["RES 5,(HL)",lt(5)],S[182]=["RES 6,(HL)",lt(6)],S[190]=["RES 7,(HL)",lt(7)],E[195]=["JP nn",function(t,e){return t.pc=e.readWord(t.pc+1),16}];var pt=function(t,e,r){return r?(t.pc=e.readWord(t.pc+1),16):(t.pc+=3,12)};E[194]=["JP NZ,nn",function(t,e){return pt(t,e,!(t.f&g))}],E[210]=["JP NC,nn",function(t,e){return pt(t,e,!(t.f&T))}],E[202]=["JP Z,nn",function(t,e){return pt(t,e,t.f&g)}],E[218]=["JP C,nn",function(t,e){return pt(t,e,t.f&T)}],E[233]=["JP (HL)",function(t){return t.pc=t.hl,4}],E[24]=["JR n",function(t,e){return t.pc+=2+e.readByte(t.pc+1).signed(),12}];var _t=function(t,e,r){return r?(t.pc+=2+e.readByte(t.pc+1).signed(),12):(t.pc+=2,8)};E[32]=["JR NZ,n",function(t,e){return _t(t,e,!(t.f&g))}],E[48]=["JR NC,n",function(t,e){return _t(t,e,!(t.f&T))}],E[40]=["JR Z,n",function(t,e){return _t(t,e,t.f&g)}],E[56]=["JR C,n",function(t,e){return _t(t,e,t.f&T)}],E[205]=["CALL nn",function(t,e){return e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24}];var yt=function(t,e,r){return r?(e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24):(t.pc+=3,12)};E[196]=["CALL NZ,nn",function(t,e){return yt(t,e,!(t.f&g))}],E[212]=["CALL NC,nn",function(t,e){return yt(t,e,!(t.f&T))}],E[204]=["CALL Z,nn",function(t,e){return yt(t,e,t.f&g)}],E[220]=["CALL C,nn",function(t,e){return yt(t,e,t.f&T)}];var dt=function(t){return function(e,r){return r.writeWord(e.sp-=2,e.pc+1),e.pc=t,16}};E[199]=["RST 00H",dt(0)],E[207]=["RST 08H",dt(8)],E[215]=["RST 10H",dt(16)],E[223]=["RST 18H",dt(24)],E[231]=["RST 20H",dt(32)],E[239]=["RST 28H",dt(40)],E[247]=["RST 30H",dt(48)],E[255]=["RST 38H",dt(56)],E[201]=["RET",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,16}];var vt=function(t,e,r){return r?(t.pc=e.readWord(t.sp),t.sp+=2,20):(t.pc+=1,8)};E[192]=["RET NZ",function(t,e){return vt(t,e,!(t.f&g))}],E[208]=["RET NC",function(t,e){return vt(t,e,!(t.f&T))}],E[200]=["RET Z",function(t,e){return vt(t,e,t.f&g)}],E[216]=["RET C",function(t,e){return vt(t,e,t.f&T)}],E[217]=["RETI",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,t.ime=!0,16}]},{"../util/number":15}],3:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:timer:step"),c=t("debug")("gameboy:timer:divider"),a=t("debug")("gameboy:timer:counter"),f=t("../util/serializable"),h=t("../registers"),l=h.DIV,p=h.TIMA,_=h.TMA,y=h.TAC,d=t("../interrupts"),v=d.INT_50,m=16384,b=[];b[0]=4096,b[1]=262144,b[2]=65536,b[3]=16384;var L=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._mmu=t,r._div=0,r._tima=0,r._tma=0,r._tac=0,r._divider=m,r._t=b[0],r}return o(e,t),u(e,[{key:"init",value:function(){this._div=0,this._tima=0,this._tma=0,this._tac=0,this._divider=m,this._t=b[0]}},{key:"step",value:function(t){s("%d",t),this._divider-=t,this._divider<=0&&(this._div=255&++this._div,c("0x%s",this._div.toString(16)),this._divider+=m),0!=(4&this._tac)&&(this._t-=t,this._t>0||(this._tima=255&++this._tima,0==this._tima&&(this._tima=this._tma,this._mmu.if|=v),a("0x%s",this._tima.toString(16)),this._t+=b[3&this._tac]))}},{key:"readByte",value:function(t){switch(t){case l:return this._div;case p:return this._tima;case _:return this._tma;case y:return this._tac}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case l:return this._div=0;case p:return this._tima=e;case _:return this._tma=e;case y:return this._tac=e}throw new Error("unmapped address 0x"+t.toString(16))}}]),e}(f({exclude:["_mmu"]}));e.exports=L},{"../interrupts":8,"../registers":12,"../util/serializable":16,debug:14}],4:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("./gpu/video"),c=t("./cpu/timer"),a=t("./gpu/lcd"),f=t("./mmu"),h=t("./gpu/gpu"),l=t("./cpu/cpu"),p=t("./io/joypad"),_=t("./util/serializable"),y=["_joypad","_useBios","_isRunning"],d=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o=new f(t),u=new s,_=new h(u),y=new c(o),d=new a(o,_),v=new l(o,y,d),m=new p(o);return r._timer=y,r._lcd=d,r._mmu=o,r._gpu=_,r._cpu=v,r._joypad=m,o.video=u,o.timer=y,o.lcd=d,o.gpu=_,o.joypad=m,r._useBios=t&&t.length>0,r._isRunning=!1,r}return o(e,t),u(e,[{key:"loadCart",value:function(t){this._isRunning=!1,this._cpu.stop(),this._mmu.loadCart(t)}},{key:"start",value:function(){this._isRunning=!0,this._init(),this._cpu.start()}},{key:"pauseResume",value:function(){this._isRunning=!this._isRunning,this._isRunning?this._cpu.start():this._cpu.stop()}},{key:"reset",value:function(){this._isRunning=!1,this._cpu.stop(),this.start()}},{key:"_init",value:function(){this._timer.init(),this._lcd.init(),this._mmu.init(),this._cpu.init(),this._useBios||(this._cpu.pc=256,
this._cpu.af=432,this._cpu.bc=19,this._cpu.de=216,this._cpu.hl=333,this._cpu.sp=65534,this._mmu.writeByte(65285,0),this._mmu.writeByte(65286,0),this._mmu.writeByte(65287,0),this._mmu.writeByte(65296,128),this._mmu.writeByte(65297,191),this._mmu.writeByte(65298,243),this._mmu.writeByte(65300,191),this._mmu.writeByte(65302,63),this._mmu.writeByte(65303,0),this._mmu.writeByte(65305,191),this._mmu.writeByte(65306,127),this._mmu.writeByte(65307,255),this._mmu.writeByte(65308,159),this._mmu.writeByte(65310,191),this._mmu.writeByte(65312,255),this._mmu.writeByte(65313,0),this._mmu.writeByte(65314,0),this._mmu.writeByte(65315,191),this._mmu.writeByte(65316,119),this._mmu.writeByte(65317,243),this._mmu.writeByte(65318,241),this._mmu.writeByte(65344,145),this._mmu.writeByte(65346,0),this._mmu.writeByte(65347,0),this._mmu.writeByte(65349,0),this._mmu.writeByte(65351,252),this._mmu.writeByte(65352,255),this._mmu.writeByte(65353,255),this._mmu.writeByte(65354,0),this._mmu.writeByte(65355,0),this._mmu.writeByte(65535,0))}},{key:"gpu",get:function(){return this._gpu}},{key:"joypad",get:function(){return this._joypad}}]),e}(_({exclude:y}));e.exports=d},{"./cpu/cpu":1,"./cpu/timer":3,"./gpu/gpu":5,"./gpu/lcd":6,"./gpu/video":7,"./io/joypad":10,"./mmu":11,"./util/serializable":16}],5:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:gpu:render"),c=t("debug")("gameboy:gpu:control"),a=t("events").EventEmitter,f=t("../shims/canvas"),h=t("../util/serializable"),l=t("../registers"),p=l.LCDC,_=l.SCY,y=l.SCX,d=l.WY,v=l.WX,m=l.BGP,b=l.OBP0,L=l.OBP1;t("../util/number");var w=[];w[0]=[255,255,255],w[1]=[192,192,192],w[2]=[96,96,96],w[3]=[0,0,0];var B=160,E=144,S=["_lcdc","_scy","_scx","_wy","_wx","_bgp","_obp0","_obp1","_bgpal","_objpal"],g=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t,r._lcdc=0,r._scy=0,r._scx=0,r._wy=0,r._wx=0,r._bgp=0,r._obp0=0,r._obp1=0,r._bgpal=null,r._objpal=[],r._canvas=new f(B,E),r._ctx=r._canvas.getContext("2d"),r._image=r._ctx.getImageData(0,0,B,E),r._data=r._image.data,r}return o(e,t),u(e,[{key:"readByte",value:function(t){switch(t){case p:return this._lcdc;case _:return this._scy;case y:return this._scx;case m:return this._bgp;case b:return this._obp0;case L:return this._obp1;case d:return this._wy;case v:return this._wx}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case p:return this._lcdc=e;case _:return this._scy=e;case y:return this._scx=e;case m:return this._bgpal=this._createPalette(e),this._bgp=e;case b:return this._objpal[0]=this._createPalette(e),this._obp0=e;case L:return this._objpal[1]=this._createPalette(e),this._obp1=e;case d:return this._wy=e;case v:return this._wx=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"drawLine",value:function(t){var e=this._lcdc>>4&1;if(1&this._lcdc){var r=this._lcdc>>3&1;this._drawBackground(t,this._scx,this._scy,r,e)}if(32&this._lcdc&&t>=this._wy){var n=this._lcdc>>6&1;this._drawWindow(t,this._wx-7,this._wy,n,e)}2&this._lcdc&&this._drawSprites(t)}},{key:"render",value:function(){s("frame"),c("%s",this._lcdc.toString(2)),this._lcdc&!1&&(this._ctx.fillStyle="white",this._ctx.fillRect(0,0,B,E)),this._ctx.putImageData(this._image,0,0),this._ctx.drawImage(this._canvas,0,0),this.emit("frame",this._canvas)}},{key:"_createPalette",value:function(t){return[w[3&t],w[t>>2&3],w[t>>4&3],w[t>>6&3]]}},{key:"_drawBackground",value:function(t,e,r,n,i){for(var o=this._video.bgMap[n],u=r+t,s=0;s<B;s++){var c=e+s,a=(255&c)>>3,f=(255&u)>>3,h=o[32*f+a],l=this._video.tiles[i?h:256+h.signed()],p=this._bgpal[l[7&u][7&c]],_=4*(t*B+s);this._data[_]=p[0],this._data[++_]=p[1],this._data[++_]=p[2],this._data[++_]=255}}},{key:"_drawWindow",value:function(t,e,r,n,i){for(var o=this._video.bgMap[n],u=t-r,s=e;s<B;s++){var c=s-e,a=c>>3,f=u>>3,h=o[32*f+a],l=this._video.tiles[i?h:256+h.signed()],p=this._bgpal[l[7&u][7&c]],_=4*(t*B+s);this._data[_]=p[0],this._data[++_]=p[1],this._data[++_]=p[2],this._data[++_]=255}}},{key:"_drawSprites",value:function(t){for(var e=4&this._lcdc?16:8,r=this._video.sprites.slice().sort(function(t,e){return t[1]-e[1]}),n=r.length-1;n>-1;n--){var i=r[n],o=i[0]-16,u=i[1]-8;if(t>=o&&t<o+e&&!(u>=B))for(var s=4&this._lcdc?254&i[2]:i[2],c=i[3],a=c>>7&1,f=c>>6&1,h=c>>5&1,l=this._objpal[c>>4&1],p=f?e-1-(t-o):t-o,_=this._data,y=u;y<u+8&&y<B;y++)if(!(y<0)){var d=4*(t*B+y);if(!a||255==_[d+0]||255==_[d+1]||255==_[d+2]){var v=this._video.tiles[s+(p>>3&1)],m=v[7&p][h?7-(y-u):y-u];if(0!=m){var b=l[m];_[d+0]=b[0],_[d+1]=b[1],_[d+2]=b[2],_[d+3]=255}}}}}}]),e}(h({include:S},a));e.exports=g},{"../registers":12,"../shims/canvas":13,"../util/number":15,"../util/serializable":16,debug:14,events:18}],6:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:lcd:step"),c=t("debug")("gameboy:lcd:stat"),a=t("../util/serializable"),f=t("../registers"),h=f.STAT,l=f.LY,p=f.LYC,_=t("../interrupts"),y=_.INT_40,d=_.INT_48,v=function(t){function e(t,r){n(this,e);var o=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o._mmu=t,o._gpu=r,o._stat=0,o._ly=0,o._lyc=0,o._t=0,o}return o(e,t),u(e,[{key:"init",value:function(){this._stat=0,this._ly=0,this._lyc=0,this._t=0}},{key:"step",value:function(t){s("%d",t),this._t+=t;var e=3&this._stat;switch(e){case 2:this._t>=80&&(this._t-=80,this._changeMode(3));break;case 3:this._t>=172&&(this._t-=172,this._changeMode(0),this._gpu.drawLine(this._ly));break;case 0:this._t>=204&&(this._t-=204,this._ly++,this._checkCoincidence(),144==this._ly?(this._changeMode(1),this._mmu.if|=y,this._gpu.render()):this._changeMode(2));break;case 1:this._t>=456&&(this._t-=456,this._ly++,this._ly>153&&(this._ly=0,this._changeMode(2)),this._checkCoincidence())}c("mode=%d; ly=%d",3&this._stat,this._ly)}},{key:"readByte",value:function(t){switch(t){case h:return this._stat;case l:return this._ly;case p:return this._lyc}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case h:return this._stat=this._stat&-121|248&e;case l:return this._ly=0;case p:return this._lyc=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_changeMode",value:function(t){var e=!1;switch(t){case 0:8&this._stat&&(e=!0);break;case 1:16&this._stat&&(e=!0);break;case 2:32&this._stat&&(e=!0)}e&&(this._mmu.if|=d),this._stat=this._stat&-4|t}},{key:"_checkCoincidence",value:function(){this._lyc==this._ly?(this._stat|=4,64&this._stat&&(this._mmu.if|=d)):this._stat&=-5}}]),e}(a({exclude:["_mmu","_gpu"]}));e.exports=v},{"../interrupts":8,"../registers":12,"../util/serializable":16,debug:14}],7:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},u=t("debug")("gameboy:video:dma"),s=function(){function t(){n(this,t),this._ram=new Uint8Array(8192),this._oam=new Uint8Array(160),this.bgMap=[new Array(1024).fill(0),new Array(1024).fill(0)],this.tiles=this._initTiles(1024),this.sprites=this._initSprites(40)}return i(t,[{key:"fromJSON",value:function(e){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromJSON",this).call(this,e),this._ram=new Uint8Array(e._ram),this._oam=new Uint8Array(e._oam)}},{key:"transfer",value:function(t,e){var r=(255&e)<<8;u("transfer from 0x%s",r.toString(16));for(var n=r;n<r+160;n++){var i=t.readByte(n),o=255&n;u("copy $%s = 0x%s",n.toString(16),i.toString(16)),this.sprites[o>>2][3&o]=i,this._oam[o]=i}}},{key:"readByte",value:function(t){switch(t>>12){case 8:case 9:return this._ram[8191&t];case 15:if(t>65183)break;if(t>65023)return this._oam[255&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 8:case 9:if(t>38911)this.bgMap[t>>10&1][1023&t]=e;else{var r=8191&t,n=this._sumBytes(this._ram[r-1],e);this.tiles[r>>4][r>>1&7]=n}return this._ram[8191&t]=e;case 15:if(t>65183)break;if(t>65023){var i=255&t;return this.sprites[i>>2][3&i]=e,this._oam[i]=e}}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_initTiles",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]];return e}},{key:"_initSprites",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[0,0,0,0];return e}},{key:"_sumBytes",value:function(t,e){for(var r=[],n=7;n>-1;n--){var i=t>>n&1|(e>>n&1)<<1;r[7-n]=i}return r}}]),t}();e.exports=s},{debug:14}],8:[function(t,e,r){"use strict";r.INT_40=1,r.INT_48=2,r.INT_50=4,r.INT_58=8,r.INT_60=16},{}],9:[function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},a=t("../util/serializable"),f=[];f[0]="ROM ONLY",f[1]="MBC1",f[2]="MBC1+RAM",f[3]="MBC1+RAM+BATTERY",f[5]="MBC2",f[6]="MBC2+BATTERY";var h=[];h[0]=1,h[1]=2,h[2]=4,h[3]=8,h[4]=16;var l=[];l[0]=0,l[1]=1,l[2]=4,l[3]=16;var p=function(t){function e(t){i(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=new Uint8Array(t);return r._title=r._sliceToString(n,308,323),r._type=n[327],r._romSize=n[328],r._ramSize=n[329],r._rom=new Uint8Array(n,0,32768*h[r._romSize]),r._ram=new Uint8Array(8192*l[r._ramSize]),r._romBank=1,r._ramBank=0,r._ramEnabled=!1,r._mode=0,r}return u(e,t),s(e,[{key:"fromJSON",value:function(t){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fromJSON",this).call(this,t),this._ram=new Uint8Array(t._ram)}},{key:"readByte",value:function(t){switch(t>>12){case 0:case 1:case 2:case 3:return this._rom[t];case 4:case 5:case 6:case 7:var e=16383&t;return this._rom[16384*this._romBank+e];case 10:case 11:var r=8191&t;return this._ram[8192*this._ramBank+r]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 0:case 1:return this._ramEnabled=10==(15&e);case 2:case 3:e&=31,0==(31&e)&&(e|=1);var r=96&this._romBank|e,n=r&2*h[this._romSize]-1;return this._romBank=n;case 4:case 5:if(e&=3,1==this._mode)return this._ramBank=e;var i=31&this._romBank|e<<5,o=i&2*h[this._romSize]-1;return this._romBank=o;case 6:case 7:return this._mode=1&e;case 10:case 11:if(!this._ramEnabled)return;var u=8191&t;return this._ram[8192*this._ramBank+u]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_sliceToString",value:function(t,e,r){return String.fromCharCode.apply(String,n(t.slice(e,r))).replace(/\0/g,"")}}]),e}(a({exclude:["_rom"]}));e.exports=p},{"../util/serializable":16}],10:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=t("debug")("gameboy:joypad"),u=t("../registers"),s=u.JOYP,c=t("../interrupts"),a=c.INT_60,f=function(){function t(e){n(this,t),this._mmu=e,this._keys={},this._select=0,this._joyp=[15,15]}return i(t,[{key:"keyDown",value:function(t){o("keydown %d",t),this._keys[t]=!0,this._update()}},{key:"keyUp",value:function(t){o("keyup %d",t),this._keys[t]=!1,this._update()}},{key:"readByte",value:function(t){if(t==s)return this._joyp[this._select];throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){if(t==s){switch(48&e){case 16:this._select=0;break;case 32:this._select=1}return this._joyp[this._select]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_update",value:function(){this._joyp=[15,15],this._keys[40]&&(this._joyp[1]&=-9),this._keys[13]&&(this._joyp[0]&=-9),this._keys[38]&&(this._joyp[1]&=-5),this._keys[16]&&(this._joyp[0]&=-5),this._keys[37]&&(this._joyp[1]&=-3),this._keys[90]&&(this._joyp[0]&=-3),this._keys[39]&&(this._joyp[1]&=-2),this._keys[88]&&(this._joyp[0]&=-2),this._mmu.if|=a}}]),t}();e.exports=f},{"../interrupts":8,"../registers":12,debug:14}],11:[function(t,e,r){(function(r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;if(void 0!==u)return u.call(n)},c=t("debug")("gameboy:mmu:read"),a=t("debug")("gameboy:mmu:write"),f=t("./io/cart"),h=t("./util/serializable"),l=t("./registers"),p=l.IF,_=l.IE,y=["video","timer","lcd","gpu","joypad"],d=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._bios=new Uint8Array(t),r._biosDisabled=0==r._bios.length,r.video=null,r.timer=null,r.lcd=null,r.gpu=null,r.joypad=null,r._wram=new Uint8Array(8192),r._io=new Uint8Array(128),r._zram=new Uint8Array(127),r._cart=null,r.if=0,r.ie=0,r}return o(e,t),u(e,[{key:"init",value:function(){this._biosDisabled=0==this._bios.length,this.if=0,this.ie=0}},{key:"fromJSON",value:function(t){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fromJSON",this).call(this,t),this._bios=new Uint8Array(t._bios),this._wram=new Uint8Array(t._wram),this._io=new Uint8Array(t._io),this._zram=new Uint8Array(t._zram)}},{key:"loadCart",value:function(t){this._cart=new f(t)}},{key:"readByte",value:function(t){switch(t&=65535,c("$%s",t.toString(16)),t>>12){case 0:if(!this._biosDisabled&&t<256)return this._bios[t];case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.readByte(t);case 8:case 9:return this.video.readByte(t);case 12:case 13:return this._wram[8191&t];case 14:case 15:if(t==_)return this.ie;if(t==p)return this.if;if(t>65407)return this._zram[127&t];if(t>65279){switch(255&t){case 0:return this.joypad.readByte(t);case 4:case 5:case 6:case 7:return this.timer.readByte(t);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.readByte(t);case 65:case 68:case 69:return this.lcd.readByte(t)}return this._io[255&t]}return t>65183?0:t>65023?this.video.readByte(t):this._wram[8191&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"readWord",value:function(t){return this.readByte(t)|this.readByte(t+1)<<8}},{key:"writeByte",value:function(t,e){if(t&=65535,e&=255,a("$%s = 0x%s",t.toString(16),e.toString(16)),r&&r.env.TEST_ROM&&65282==t&&129==e){var n=String.fromCharCode(this.readByte(65281));r.stdout.write(n)}switch(t>>12){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.writeByte(t,e);case 8:case 9:return this.video.writeByte(t,e);case 12:case 13:return this._wram[8191&t]=e;case 14:case 15:if(t==_)return this.ie=e;if(t==p)return this.if=e;if(t>65407)return this._zram[127&t]=e;if(t>65279){switch(255&t){case 0:return this.joypad.writeByte(t,e);case 4:case 5:case 6:case 7:return this.timer.writeByte(t,e);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.writeByte(t,e);case 65:case 68:case 69:return this.lcd.writeByte(t,e);case 70:this.video.transfer(this,e);break;case 80:this._biosDisabled=!0}return this._io[255&t]=e}if(t>65183)return;return t>65023?this.video.writeByte(t,e):this._wram[8191&t]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeWord",value:function(t,e){this.writeByte(t,e),this.writeByte(t+1,e>>8)}}]),e}(h({exclude:y}));e.exports=d}).call(this,t("_process"))},{"./io/cart":9,"./registers":12,"./util/serializable":16,_process:20,debug:14}],12:[function(t,e,r){"use strict";r.JOYP=65280,r.DIV=65284,r.TIMA=65285,r.TMA=65286,r.TAC=65287,r.IF=65295,r.LCDC=65344,r.STAT=65345,r.SCY=65346,r.SCX=65347,r.LY=65348,r.LYC=65349,r.DMA=65350,r.BGP=65351,r.OBP0=65352,r.OBP1=65353,r.WY=65354,r.WX=65355,r.IE=65535},{}],13:[function(t,e,r){"use strict";function n(e,r){if("undefined"!=typeof window){var n=document.createElement("canvas");return n.width=e,n.height=r,n}return new(t("canvas"))(e,r)}e.exports=n},{canvas:17}],14:[function(t,e,r){"use strict";e.exports=function(){return function(){}}},{}],15:[function(t,e,r){"use strict";Number.prototype.signed=function(){return 128&this?-((255&~this)+1):this}},{}],16:[function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){function t(){o(this,t)}return t}();return function(e){function r(){return o(this,r),n(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return i(r,e),s(r,[{key:"toJSON",value:function(){var e=this,r=t.exclude,n=t.include,i=function(){return!1};return r&&(i=function(t){return r.indexOf(t)<0}),n&&(i=function(t){return n.indexOf(t)>-1}),Object.keys(this).filter(i).reduce(function(t,r){var n=void 0,i=e[r];return"object"==("undefined"==typeof i?"undefined":u(i))?"function"==typeof i.toJSON?n=i.toJSON():"Uint8Array"==i.constructor.name&&(n=Array.from(e[r])):n=e[r],t[r]=n,t},{})}},{key:"fromJSON",value:function(t){var e=this;Object.keys(t).filter(function(t){return e.hasOwnProperty(t)}).forEach(function(r){var n=e[r];"object"==("undefined"==typeof n?"undefined":u(n))&&n.fromJSON?n.fromJSON(t[r]):e[r]=t[r]})}}]),r}(e)};e.exports=c},{}],17:[function(t,e,r){"use strict"},{}],18:[function(t,e,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function u(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,r,n,o,c,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var f=new Error('Uncaught, unspecified "error" event. ('+e+")");throw f.context=e,f}if(r=this._events[t],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),r.apply(this,o)}else if(u(r))for(o=Array.prototype.slice.call(arguments,1),a=r.slice(),n=a.length,c=0;c<n;c++)a[c].apply(this,o);return!0},n.prototype.addListener=function(t,e){var r;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?u(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,u(this._events[t])&&!this._events[t].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var n=!1;return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var r,n,o,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],o=r.length,n=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(u(r)){for(s=o;s-- >0;)if(r[s]===e||r[s].listener&&r[s].listener===e){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],i(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],19:[function(t,e,r){(function(t){(function(){var r,n,i;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof t&&null!==t&&t.hrtime?(e.exports=function(){return(r()-i)/1e6},n=t.hrtime,r=function(){var t;return t=n(),1e9*t[0]+t[1]},i=r()):Date.now?(e.exports=function(){return Date.now()-i},i=Date.now()):(e.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)}).call(this,t("_process"))},{_process:20}],20:[function(t,e,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function u(t){if(l===clearTimeout)return clearTimeout(t);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){d&&_&&(d=!1,_.length?y=_.concat(y):v=-1,y.length&&c())}function c(){if(!d){var t=o(s);d=!0;for(var e=y.length;e;){for(_=y,y=[];++v<e;)_&&_[v].run();v=-1,e=y.length}_=null,d=!1,u(t)}}function a(t,e){this.fun=t,this.array=e}function f(){}var h,l,p=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(t){l=i}}();var _,y=[],d=!1,v=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];y.push(new a(t,e)),1!==y.length||d||o(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=f,p.addListener=f,p.once=f,p.off=f,p.removeListener=f,p.removeAllListeners=f,p.emit=f,p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],21:[function(t,e,r){(function(r){for(var n=t("performance-now"),i="undefined"==typeof window?r:window,o=["moz","webkit"],u="AnimationFrame",s=i["request"+u],c=i["cancel"+u]||i["cancelRequest"+u],a=0;!s&&a<o.length;a++)s=i[o[a]+"Request"+u],c=i[o[a]+"Cancel"+u]||i[o[a]+"CancelRequest"+u];if(!s||!c){var f=0,h=0,l=[],p=1e3/60;s=function(t){if(0===l.length){var e=n(),r=Math.max(0,p-(e-f));f=r+e,setTimeout(function(){var t=l.slice(0);l.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(f)}catch(t){setTimeout(function(){throw t},0)}},Math.round(r))}return l.push({handle:++h,callback:t,cancelled:!1}),h},c=function(t){for(var e=0;e<l.length;e++)l[e].handle===t&&(l[e].cancelled=!0)}}e.exports=function(t){return s.call(i,t)},e.exports.cancel=function(){c.apply(i,arguments)},e.exports.polyfill=function(){i.requestAnimationFrame=s,i.cancelAnimationFrame=c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":19}]},{},[4])(4)});
