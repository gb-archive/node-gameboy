!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Gameboy=t()}}(function(){return function t(e,r,n){function i(u,a){if(!r[u]){if(!e[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(s)return s(u,!0);var o=new Error("Cannot find module '"+u+"'");throw o.code="MODULE_NOT_FOUND",o}var h=r[u]={exports:{}};e[u][0].call(h.exports,function(t){var r=e[u][1][t];return i(r?r:t)},h,h.exports,t,e,r,n)}return r[u].exports}for(var s="function"==typeof require&&require,u=0;u<n.length;u++)i(n[u]);return i}({1:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){var r=[],n=!0,i=!1,s=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){i=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw s}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=t("debug")("gameboy:cpu"),a=t("debug")("gameboy:cpu:cycle"),c=t("debug")("gameboy:cpu:int"),o=t("raf"),h=t("./opcodes"),f=t("../interrupts"),l=f.INT_40,_=f.INT_48,p=f.INT_50,d=f.INT_58,y=f.INT_60,v=function(){function t(e,r,i){n(this,t),this._mmu=e,this._timer=r,this._lcd=i,this._loop=null,this.ime=!1,this._a=0,this._f=0,this._b=0,this._c=0,this._d=0,this._e=0,this._h=0,this._l=0,this._sp=0,this._pc=0}return s(t,[{key:"init",value:function(){this.ime=!1,this._a=0,this._f=0,this._b=0,this._c=0,this._d=0,this._e=0,this._h=0,this._l=0,this._sp=0,this._pc=0}},{key:"start",value:function(){var t=this;u("start");var e=function e(){t._step(),t._loop=o(e)};this._loop=o(e)}},{key:"stop",value:function(){u("stop"),o.cancel(this._loop)}},{key:"_step",value:function(){for(var t=0,e=0;t<70224;){var r=this._runCycle()+e;this._timer.step(r),this._lcd.step(r),e=this._handleInterrupts(),t+=r}}},{key:"_runCycle",value:function(){var t=this._mmu.readByte(this._pc),e=h.$;203==t&&(t=this._mmu.readByte(this._pc+1),e=h.$[203]);var r=i(e[t],2),n=r[0],s=r[1];return a("%s; $%s",n,this._pc.toString(16)),s(this,this._mmu)}},{key:"_handleInterrupts",value:function(){if(!this.ime)return 0;var t=this._mmu.ie&this._mmu.if;if(0==t)return 0;c("flags 0b%s",t.toString(2));var e=void 0;return t&l?(this._mmu.if&=~l,e=64):t&_?(this._mmu.if&=~_,e=72):t&p?(this._mmu.if&=~p,e=80):t&d?(this._mmu.if&=~d,e=88):t&y&&(this._mmu.if&=~y,e=96),this.ime=!1,this._mmu.writeWord(this._sp-=2,this._pc),this._pc=e,16}},{key:"a",get:function(){return this._a},set:function(t){this._a=255&t}},{key:"f",get:function(){return this._f},set:function(t){this._f=240&t}},{key:"b",get:function(){return this._b},set:function(t){this._b=255&t}},{key:"c",get:function(){return this._c},set:function(t){this._c=255&t}},{key:"d",get:function(){return this._d},set:function(t){this._d=255&t}},{key:"e",get:function(){return this._e},set:function(t){this._e=255&t}},{key:"h",get:function(){return this._h},set:function(t){this._h=255&t}},{key:"l",get:function(){return this._l},set:function(t){this._l=255&t}},{key:"af",get:function(){return this._a<<8|this._f},set:function(t){this.a=t>>8,this.f=t}},{key:"bc",get:function(){return this._b<<8|this._c},set:function(t){this.b=t>>8,this.c=t}},{key:"de",get:function(){return this._d<<8|this._e},set:function(t){this.d=t>>8,this.e=t}},{key:"hl",get:function(){return this._h<<8|this._l},set:function(t){this.h=t>>8,this.l=t}},{key:"sp",get:function(){return this._sp},set:function(t){this._sp=65535&t}},{key:"pc",get:function(){return this._pc},set:function(t){this._pc=65535&t}}]),t}();e.exports=v},{"../interrupts":8,"./opcodes":2,debug:14,raf:20}],2:[function(t,e,r){"use strict";function n(t,e){var r=e.readByte(t.pc+1).signed(),n=t.sp+r,i=t.sp^r^n;return t.f=0,0!=(16&i)&&(t.f|=A),0!=(256&i)&&(t.f|=T),n}function i(t,e){var r=t.a+e;return t.f=0,0==(255&r)&&(t.f|=D),0!=(16&(t.a^e^r))&&(t.f|=A),0!=(256&r)&&(t.f|=T),r}function s(t,e){var r=t.f>>4&1,n=t.a+e+r;return t.f=0,0==(255&n)&&(t.f|=D),0!=(16&(t.a^e^n))&&(t.f|=A),0!=(256&n)&&(t.f|=T),n}function u(t,e){var r=t.a-e;return t.f=g,0==(255&r)&&(t.f|=D),0!=(16&(t.a^e^r))&&(t.f|=A),0!=(256&r)&&(t.f|=T),r}function a(t,e){var r=t.f>>4&1,n=t.a-e-r;return t.f=g,0==(255&n)&&(t.f|=D),0!=(16&(t.a^e^n))&&(t.f|=A),0!=(256&n)&&(t.f|=T),n}function c(t,e){var r=t.a&e;return t.f=A,0==(255&r)&&(t.f|=D),r}function o(t,e){var r=t.a|e;return t.f=0,0==(255&r)&&(t.f|=D),r}function h(t,e){var r=t.a^e;return t.f=0,0==(255&r)&&(t.f|=D),r}function f(t,e){var r=e+1;return t.f&=-225,0==(255&r)&&(t.f|=D),15==(15&e)&&(t.f|=A),r}function l(t,e){var r=e-1;return t.f&=-225,0==(255&r)&&(t.f|=D),t.f|=g,0==(15&e)&&(t.f|=A),r}function _(t,e){var r=e<<4|e>>4;return t.f=0,0==(255&r)&&(t.f|=D),r}function p(t,e){var r=e<<1|e>>7;return t.f=0,0==(255&r)&&(t.f|=D),0!=(128&e)&&(t.f|=T),r}function d(t,e){var r=t.f>>4&1,n=e<<1|r;return t.f=0,0==(255&n)&&(t.f|=D),0!=(128&e)&&(t.f|=T),n}function y(t,e){var r=e>>1|e<<7;return t.f=0,0==(255&r)&&(t.f|=D),0!=(1&e)&&(t.f|=T),r}function v(t,e){var r=t.f>>4&1,n=r<<7|e>>1;return t.f=0,0==(255&n)&&(t.f|=D),0!=(1&e)&&(t.f|=T),n}function m(t,e){var r=e<<1;return t.f=0,0==(255&r)&&(t.f|=D),0!=(128&e)&&(t.f|=T),r}function L(t,e){var r=128&e|e>>1;return t.f=0,0==(255&r)&&(t.f|=D),0!=(1&e)&&(t.f|=T),r}function B(t,e){var r=e>>1;return t.f=0,0==(255&r)&&(t.f|=D),0!=(1&e)&&(t.f|=T),r}function E(t,e,r){var n=r&1<<e;return t.f&=-225,0==n&&(t.f|=D),t.f|=A,n}t("../util/number");var w=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(e,r){var n=r.readByte(e.pc),i=""+t.toString(16)+n.toString(16),s=e.pc.toString(16);throw new Error("unknown opcode 0x"+i+"; $"+s)}},S=r.$=new Array(255).fill([null,w()]),b=S[203]=new Array(255).fill([null,w(203)]),D=128,g=64,A=32,T=16,C=function(t){return function(e,r){return e[t]=r.readByte(e.pc+1),e.pc+=2,8}};S[6]=["LD B,n",C("b")],S[14]=["LD C,n",C("c")],S[22]=["LD D,n",C("d")],S[30]=["LD E,n",C("e")],S[38]=["LD H,n",C("h")],S[46]=["LD L,n",C("l")];var R=function(t,e){return function(r){return r[t]=r[e],r.pc+=1,4}};S[120]=["LD A,B",R("a","b")],S[121]=["LD A,C",R("a","c")],S[122]=["LD A,D",R("a","d")],S[123]=["LD A,E",R("a","e")],S[124]=["LD A,H",R("a","h")],S[125]=["LD A,L",R("a","l")],S[127]=["LD A,A",R("a","a")],S[64]=["LD B,B",R("b","b")],S[65]=["LD B,C",R("b","c")],S[66]=["LD B,D",R("b","d")],S[67]=["LD B,E",R("b","e")],S[68]=["LD B,H",R("b","h")],S[69]=["LD B,L",R("b","l")],S[72]=["LD C,B",R("c","b")],S[73]=["LD C,C",R("c","c")],S[74]=["LD C,D",R("c","d")],S[75]=["LD C,E",R("c","e")],S[76]=["LD C,H",R("c","h")],S[77]=["LD C,L",R("c","l")],S[80]=["LD D,B",R("d","b")],S[81]=["LD D,C",R("d","c")],S[82]=["LD D,D",R("d","d")],S[83]=["LD D,E",R("d","e")],S[84]=["LD D,H",R("d","h")],S[85]=["LD D,L",R("d","l")],S[88]=["LD E,B",R("e","b")],S[89]=["LD E,C",R("e","c")],S[90]=["LD E,D",R("e","d")],S[91]=["LD E,E",R("e","e")],S[92]=["LD E,H",R("e","h")],S[93]=["LD E,L",R("e","l")],S[96]=["LD H,B",R("h","b")],S[97]=["LD H,C",R("h","c")],S[98]=["LD H,D",R("h","d")],S[99]=["LD H,E",R("h","e")],S[100]=["LD H,H",R("h","h")],S[101]=["LD H,L",R("h","l")],S[104]=["LD L,B",R("l","b")],S[105]=["LD L,C",R("l","c")],S[106]=["LD L,D",R("l","d")],S[107]=["LD L,E",R("l","e")],S[108]=["LD L,H",R("l","h")],S[109]=["LD L,L",R("l","l")];var H=function(t){return function(e,r){return e[t]=r.readByte(e.hl),e.pc+=1,8}};S[70]=["LD B,(HL)",H("b")],S[78]=["LD C,(HL)",H("c")],S[86]=["LD D,(HL)",H("d")],S[94]=["LD E,(HL)",H("e")],S[102]=["LD H,(HL)",H("h")],S[110]=["LD L,(HL)",H("l")],S[126]=["LD A,(HL)",H("a")];var k=function(t){return function(e,r){return r.writeByte(e.hl,e[t]),e.pc+=1,8}};S[112]=["LD (HL),B",k("b")],S[113]=["LD (HL),C",k("c")],S[114]=["LD (HL),D",k("d")],S[115]=["LD (HL),E",k("e")],S[116]=["LD (HL),H",k("h")],S[117]=["LD (HL),L",k("l")],S[54]=["LD (HL),n",function(t,e){return e.writeByte(t.hl,e.readByte(t.pc+1)),t.pc+=2,12}];var I=function(t){return function(e){return e.a=e[t],e.pc+=1,4}};S[120]=["LD A,B",I("b")],S[121]=["LD A,C",I("c")],S[122]=["LD A,D",I("d")],S[123]=["LD A,E",I("e")],S[124]=["LD A,H",I("h")],S[125]=["LD A,L",I("l")],S[127]=["LD A,A",I("a")];var x=function(t){return function(e,r){return e.a=r.readByte(e[t]),e.pc+=1,8}};S[10]=["LD A,(BC)",x("bc")],S[26]=["LD A,(DE)",x("de")],S[126]=["LD A,(HL)",x("hl")],S[250]=["LD A,(nn)",function(t,e){return t.a=e.readByte(e.readWord(t.pc+1)),t.pc+=3,16}],S[62]=["LD A,n",function(t,e){return t.a=e.readByte(t.pc+1),t.pc+=2,8}];var P=function(t){return function(e){return e[t]=e.a,e.pc+=1,4}};S[71]=["LD B,A",P("b")],S[79]=["LD C,A",P("c")],S[87]=["LD D,A",P("d")],S[95]=["LD E,A",P("e")],S[103]=["LD H,A",P("h")],S[111]=["LD L,A",P("l")],S[127]=["LD A,A",P("a")];var O=function(t){return function(e,r){return r.writeByte(e[t],e.a),e.pc+=1,8}};S[2]=["LD (BC),A",O("bc")],S[18]=["LD (DE),A",O("de")],S[119]=["LD (HL),A",O("hl")],S[234]=["LD (nn),A",function(t,e){return e.writeByte(e.readWord(t.pc+1),t.a),t.pc+=3,16}],S[242]=["LD A,(C)",function(t,e){return t.a=e.readByte(65280+t.c),t.pc+=1,8}],S[226]=["LD (C),A",function(t,e){return e.writeByte(65280+t.c,t.a),t.pc+=1,8}],S[58]=["LD A,(HL-)",function(t,e){return t.a=e.readByte(t.hl--),t.pc+=1,8}],S[50]=["LD (HL-),A",function(t,e){return e.writeByte(t.hl--,t.a),t.pc+=1,8}],S[42]=["LD A,(HL+)",function(t,e){return t.a=e.readByte(t.hl++),t.pc+=1,8}],S[34]=["LD (HL+),A",function(t,e){return e.writeByte(t.hl++,t.a),t.pc+=1,8}],S[224]=["LDH (n),A",function(t,e){var r=e.readByte(t.pc+1);return e.writeByte(65280+r,t.a),t.pc+=2,12}],S[240]=["LDH A,(n)",function(t,e){var r=e.readByte(t.pc+1);return t.a=e.readByte(65280+r),t.pc+=2,12}];var N=function(t){return function(e,r){return e[t]=r.readWord(e.pc+1),e.pc+=3,12}};S[1]=["LD BC,nn",N("bc")],S[17]=["LD DE,nn",N("de")],S[33]=["LD HL,nn",N("hl")],S[49]=["LD SP,nn",N("sp")],S[249]=["LD SP,HL",function(t){return t.sp=t.hl,t.pc+=1,8}],S[248]=["LD HL,SP+n",function(t,e){return t.hl=n(t,e),t.pc+=2,12}],S[8]=["LD (nn),SP",function(t,e){return e.writeWord(e.readWord(t.pc+1),t.sp),t.pc+=3,20}];var j=function(t){return function(e,r){return r.writeWord(e.sp-=2,e[t]),e.pc+=1,16}};S[197]=["PUSH BC",j("bc")],S[213]=["PUSH DE",j("de")],S[229]=["PUSH HL",j("hl")],S[245]=["PUSH AF",j("af")];var W=function(t){return function(e,r){return e[t]=r.readWord(e.sp),e.sp+=2,e.pc+=1,12}};S[193]=["POP BC",W("bc")],S[209]=["POP DE",W("de")],S[225]=["POP HL",W("hl")],S[241]=["POP AF",W("af")];var M=function(t){return function(e){return e.a=i(e,e[t]),e.pc+=1,4}};S[128]=["ADD A,B",M("b")],S[129]=["ADD A,C",M("c")],S[130]=["ADD A,D",M("d")],S[131]=["ADD A,E",M("e")],S[132]=["ADD A,H",M("h")],S[133]=["ADD A,L",M("l")],S[135]=["ADD A,A",M("a")],S[134]=["ADD A,(HL)",function(t,e){var r=e.readByte(t.hl);return t.a=i(t,r),t.pc+=1,8}],S[198]=["ADD A,#",function(t,e){var r=e.readByte(t.pc+1);return t.a=i(t,r),t.pc+=2,8}];var U=function(t){return function(e){return e.a=s(e,e[t]),e.pc+=1,4}};S[136]=["ADC A,B",U("b")],S[137]=["ADC A,C",U("c")],S[138]=["ADC A,D",U("d")],S[139]=["ADC A,E",U("e")],S[140]=["ADC A,H",U("h")],S[141]=["ADC A,L",U("l")],S[143]=["ADC A,A",U("a")],S[142]=["ADC A,(HL)",function(t,e){return t.a=s(t,e.readByte(t.hl)),t.pc+=1,8}],S[206]=["ADC A,#",function(t,e){return t.a=s(t,e.readByte(t.pc+1)),t.pc+=2,8}];var z=function(t){return function(e){return e.a=u(e,e[t]),e.pc+=1,4}};S[144]=["SUB B",z("b")],S[145]=["SUB C",z("c")],S[146]=["SUB D",z("d")],S[147]=["SUB E",z("e")],S[148]=["SUB H",z("h")],S[149]=["SUB L",z("l")],S[151]=["SUB A",z("a")],S[150]=["SUB (HL)",function(t,e){return t.a=u(t,e.readByte(t.hl)),t.pc+=1,8}],S[214]=["SUB #",function(t,e){return t.a=u(t,e.readByte(t.pc+1)),t.pc+=2,8}];var J=function(t){return function(e){return e.a=a(e,e[t]),e.pc+=1,4}};S[152]=["SBC A,B",J("b")],S[153]=["SBC A,C",J("c")],S[154]=["SBC A,D",J("d")],S[155]=["SBC A,E",J("e")],S[156]=["SBC A,H",J("h")],S[157]=["SBC A,L",J("l")],S[159]=["SBC A,A",J("a")],S[158]=["SBC A,(HL)",function(t,e){return t.a=a(t,e.readByte(t.hl)),t.pc+=1,8}],S[222]=["SBC A,#",function(t,e){return t.a=a(t,e.readByte(t.pc+1)),t.pc+=2,8}];var X=function(t){return function(e){return e.a=c(e,e[t]),e.pc+=1,4}};S[160]=["AND B",X("b")],S[161]=["AND C",X("c")],S[162]=["AND D",X("d")],S[163]=["AND E",X("e")],S[164]=["AND H",X("h")],S[165]=["AND L",X("l")],S[167]=["AND A",X("a")],S[166]=["AND (HL)",function(t,e){return t.a=c(t,e.readByte(t.hl)),t.pc+=1,8}],S[230]=["AND #",function(t,e){return t.a=c(t,e.readByte(t.pc+1)),t.pc+=2,8}];var Y=function(t){return function(e){return e.a=o(e,e[t]),e.pc+=1,4}};S[176]=["OR B",Y("b")],S[177]=["OR C",Y("c")],S[178]=["OR D",Y("d")],S[179]=["OR E",Y("e")],S[180]=["OR H",Y("h")],S[181]=["OR L",Y("l")],S[183]=["OR A",Y("a")],S[182]=["OR (HL)",function(t,e){return t.a=o(t,e.readByte(t.hl)),t.pc+=1,4}],S[246]=["OR #",function(t,e){return t.a=o(t,e.readByte(t.pc+1)),t.pc+=2,4}];var F=function(t){return function(e){return e.a=h(e,e[t]),e.pc+=1,4}};S[168]=["XOR B",F("b")],S[169]=["XOR C",F("c")],S[170]=["XOR D",F("d")],S[171]=["XOR E",F("e")],S[172]=["XOR H",F("h")],S[173]=["XOR L",F("l")],S[175]=["XOR A",F("a")],S[174]=["XOR (HL)",function(t,e){return t.a=h(t,e.readByte(t.hl)),t.pc+=1,8}],S[238]=["XOR #",function(t,e){return t.a=h(t,e.readByte(t.pc+1)),t.pc+=2,8}];var q=function(t){return function(e){return u(e,e[t]),e.pc+=1,4}};S[184]=["CP B",q("b")],S[185]=["CP C",q("c")],S[186]=["CP D",q("d")],S[187]=["CP E",q("e")],S[188]=["CP H",q("h")],S[189]=["CP L",q("l")],S[191]=["CP A",q("a")],S[190]=["CP (HL)",function(t,e){return u(t,e.readByte(t.hl)),t.pc+=1,8}],S[254]=["CP #",function(t,e){return u(t,e.readByte(t.pc+1)),t.pc+=2,8}];var Z=function(t){return function(e){return e[t]=f(e,e[t]),e.pc+=1,4}};S[4]=["INC B",Z("b")],S[12]=["INC C",Z("c")],S[20]=["INC D",Z("d")],S[28]=["INC E",Z("e")],S[36]=["INC H",Z("h")],S[44]=["INC L",Z("l")],S[60]=["INC A",Z("a")],S[52]=["INC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,f(t,r)),t.pc+=1,12}];var $=function(t){return function(e){return e[t]=l(e,e[t]),e.pc+=1,4}};S[5]=["DEC B",$("b")],S[13]=["DEC C",$("c")],S[21]=["DEC D",$("d")],S[29]=["DEC E",$("e")],S[37]=["DEC H",$("h")],S[45]=["DEC L",$("l")],S[61]=["DEC A",$("a")],S[53]=["DEC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,l(t,r)),t.pc+=1,12}];var G=function(t){return function(e,r){var n=e.hl+e[t];return e.f&=-113,0!=(4096&(e.hl^e[t]^n))&&(e.f|=A),0!=(65536&n)&&(e.f|=T),e.hl=n,e.pc+=1,8}};S[9]=["ADD HL,BC",G("bc")],S[25]=["ADD HL,DE",G("de")],S[41]=["ADD HL,HL",G("hl")],S[57]=["ADD HL,SP",G("sp")],S[232]=["ADD SP,#",function(t,e){return t.sp=n(t,e),t.pc+=2,16}];var V=function(t){return function(e){return e[t]++,e.pc+=1,8}};S[3]=["INC BC",V("bc")],S[19]=["INC DE",V("de")],S[35]=["INC HL",V("hl")],S[51]=["INC SP",V("sp")];var K=function(t){return function(e){return e[t]--,e.pc+=1,8}};S[11]=["DEC BC",K("bc")],S[27]=["DEC DE",K("de")],S[43]=["DEC HL",K("hl")],S[59]=["DEC SP",K("sp")];var Q=function(t){return function(e){return e[t]=_(e,e[t]),e.pc+=2,8}};b[48]=["SWAP B",Q("b")],b[49]=["SWAP C",Q("c")],b[50]=["SWAP D",Q("d")],b[51]=["SWAP E",Q("e")],b[52]=["SWAP H",Q("h")],b[53]=["SWAP L",Q("l")],b[55]=["SWAP A",Q("a")],b[54]=["SWAP (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,_(t,r)),t.pc+=2,16}],S[39]=["DAA",function(t){var e=void 0,r=0;return t.f&A&&(r|=6),t.f&T&&(r|=96),t.f&g?e=t.a-r:((15&t.a)>9&&(r|=6),t.a>153&&(r|=96),e=t.a+r),t.f&=-177,0==(255&e)&&(t.f|=D),0!=(96&r)&&(t.f|=T),t.a=e,t.pc+=1,4}],S[47]=["CPL",function(t){return t.a^=255,t.f|=96,t.pc+=1,4}],S[63]=["CCF",function(t){return t.f&=-97,t.f^=T,t.pc+=1,4}],S[55]=["SCF",function(t){return t.f&=-97,t.f|=T,t.pc+=1,4}],S[0]=["NOP",function(t){return t.pc+=1,4}],S[118]=["HALT",function(t){return t.pc+=1,4}],S[16]=["STOP",function(t){return t.pc+=2,4}],S[243]=["DI",function(t){return t.ime=!1,t.pc+=1,4}],S[251]=["EI",function(t){return t.ime=!0,t.pc+=1,4}],S[7]=["RLCA",function(t){var e=t.a>>7;return t.f=0,0!=e&&(t.f|=T),t.a=t.a<<1|e,t.pc+=1,4}],S[23]=["RLA",function(t){var e=t.a>>7,r=t.f>>4&1;return t.f=0,0!=e&&(t.f|=T),t.a=t.a<<1|r,t.pc+=1,4}],S[15]=["RRCA",function(t){var e=1&t.a;return t.f=0,0!=e&&(t.f|=T),t.a=t.a>>1|e<<7,t.pc+=1,4}],S[31]=["RRA",function(t){var e=1&t.a,r=t.f>>4&1;return t.f=0,0!=e&&(t.f|=T),t.a=t.a>>1|r<<7,t.pc+=1,4}];var tt=function(t){return function(e){return e[t]=p(e,e[t]),e.pc+=2,8}};b[0]=["RLC B",tt("b")],b[1]=["RLC C",tt("c")],b[2]=["RLC D",tt("d")],b[3]=["RLC E",tt("e")],b[4]=["RLC H",tt("h")],b[5]=["RLC L",tt("l")],b[7]=["RLC A",tt("a")],b[6]=["RLC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,p(t,r)),t.pc+=2,16}];var et=function(t){return function(e){return e[t]=d(e,e[t]),e.pc+=2,8}};b[16]=["RL B",et("b")],b[17]=["RL C",et("c")],b[18]=["RL D",et("d")],b[19]=["RL E",et("e")],b[20]=["RL H",et("h")],b[21]=["RL L",et("l")],b[23]=["RL A",et("a")],b[22]=["RL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,d(t,r)),t.pc+=2,16}];var rt=function(t){return function(e){return e[t]=y(e,e[t]),e.pc+=2,8}};b[8]=["RRC B",rt("b")],b[9]=["RRC C",rt("c")],b[10]=["RRC D",rt("d")],b[11]=["RRC E",rt("e")],b[12]=["RRC H",rt("h")],b[13]=["RRC L",rt("l")],b[15]=["RRC A",rt("a")],b[14]=["RRC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,y(t,r)),t.pc+=2,16}];var nt=function(t){return function(e){return e[t]=v(e,e[t]),e.pc+=2,8}};b[24]=["RR B",nt("b")],b[25]=["RR C",nt("c")],b[26]=["RR D",nt("d")],b[27]=["RR E",nt("e")],b[28]=["RR H",nt("h")],b[29]=["RR L",nt("l")],b[31]=["RR A",nt("a")],b[30]=["RR (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,v(t,r)),t.pc+=2,16}];var it=function(t){return function(e){return e[t]=m(e,e[t]),e.pc+=2,8}};b[32]=["SLA B",it("b")],b[33]=["SLA C",it("c")],b[34]=["SLA D",it("d")],b[35]=["SLA E",it("e")],b[36]=["SLA H",it("h")],b[37]=["SLA L",it("l")],b[39]=["SLA A",it("a")],b[38]=["SLA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,m(t,r)),t.pc+=2,16}];var st=function(t){return function(e){return e[t]=L(e,e[t]),e.pc+=2,8}};b[40]=["SRA B",st("b")],b[41]=["SRA C",st("c")],b[42]=["SRA D",st("d")],b[43]=["SRA E",st("e")],b[44]=["SRA H",st("h")],b[45]=["SRA L",st("l")],b[47]=["SRA A",st("a")],b[46]=["SRA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,L(t,r)),t.pc+=2,16}];var ut=function(t){return function(e){return e[t]=B(e,e[t]),e.pc+=2,8}};b[56]=["SRL B",ut("b")],b[57]=["SRL C",ut("c")],b[58]=["SRL D",ut("d")],b[59]=["SRL E",ut("e")],b[60]=["SRL H",ut("h")],b[61]=["SRL L",ut("l")],b[63]=["SRL A",ut("a")],b[62]=["SRL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,B(t,r)),t.pc+=2,16}];var at=function(t,e){return function(r){return E(r,t,r[e]),r.pc+=2,8}};b[64]=["BIT 0,B",at(0,"b")],b[65]=["BIT 0,C",at(0,"c")],b[66]=["BIT 0,D",at(0,"d")],b[67]=["BIT 0,E",at(0,"e")],b[68]=["BIT 0,H",at(0,"h")],b[69]=["BIT 0,L",at(0,"l")],b[71]=["BIT 0,A",at(0,"a")],b[72]=["BIT 1,B",at(1,"b")],b[73]=["BIT 1,C",at(1,"c")],b[74]=["BIT 1,D",at(1,"d")],b[75]=["BIT 1,E",at(1,"e")],b[76]=["BIT 1,H",at(1,"h")],b[77]=["BIT 1,L",at(1,"l")],b[79]=["BIT 1,A",at(1,"a")],b[80]=["BIT 2,B",at(2,"b")],b[81]=["BIT 2,C",at(2,"c")],b[82]=["BIT 2,D",at(2,"d")],b[83]=["BIT 2,E",at(2,"e")],b[84]=["BIT 2,H",at(2,"h")],b[85]=["BIT 2,L",at(2,"l")],b[87]=["BIT 2,A",at(2,"a")],b[88]=["BIT 3,B",at(3,"b")],b[89]=["BIT 3,C",at(3,"c")],b[90]=["BIT 3,D",at(3,"d")],b[91]=["BIT 3,E",at(3,"e")],b[92]=["BIT 3,H",at(3,"h")],b[93]=["BIT 3,L",at(3,"l")],b[95]=["BIT 3,A",at(3,"a")],b[96]=["BIT 4,B",at(4,"b")],b[97]=["BIT 4,C",at(4,"c")],b[98]=["BIT 4,D",at(4,"d")],b[99]=["BIT 4,E",at(4,"e")],b[100]=["BIT 4,H",at(4,"h")],b[101]=["BIT 4,L",at(4,"l")],b[103]=["BIT 4,A",at(4,"a")],b[104]=["BIT 5,B",at(5,"b")],b[105]=["BIT 5,C",at(5,"c")],b[106]=["BIT 5,D",at(5,"d")],b[107]=["BIT 5,E",at(5,"e")],b[108]=["BIT 5,H",at(5,"h")],b[109]=["BIT 5,L",at(5,"l")],b[111]=["BIT 5,A",at(5,"a")],b[112]=["BIT 6,B",at(6,"b")],b[113]=["BIT 6,C",at(6,"c")],b[114]=["BIT 6,D",at(6,"d")],b[115]=["BIT 6,E",at(6,"e")],b[116]=["BIT 6,H",at(6,"h")],b[117]=["BIT 6,L",at(6,"l")],b[119]=["BIT 6,A",at(6,"a")],b[120]=["BIT 7,B",at(7,"b")],b[121]=["BIT 7,C",at(7,"c")],b[122]=["BIT 7,D",at(7,"d")],b[123]=["BIT 7,E",at(7,"e")],b[124]=["BIT 7,H",at(7,"h")],b[125]=["BIT 7,L",at(7,"l")],b[127]=["BIT 7,A",at(7,"a")];var ct=function(t){return function(e,r){return E(e,t,r.readByte(e.hl)),e.pc+=2,16}};b[70]=["BIT 0,(HL)",ct(0)],b[78]=["BIT 1,(HL)",ct(1)],b[86]=["BIT 2,(HL)",ct(2)],b[94]=["BIT 3,(HL)",ct(3)],b[102]=["BIT 4,(HL)",ct(4)],b[110]=["BIT 5,(HL)",ct(5)],b[118]=["BIT 6,(HL)",ct(6)],b[126]=["BIT 7,(HL)",ct(7)];var ot=function(t,e){return function(r){return r[e]|=1<<t,r.pc+=2,8}};b[192]=["SET 0,B",ot(0,"b")],b[193]=["SET 0,C",ot(0,"c")],b[194]=["SET 0,D",ot(0,"d")],b[195]=["SET 0,E",ot(0,"e")],b[196]=["SET 0,H",ot(0,"h")],b[197]=["SET 0,L",ot(0,"l")],b[199]=["SET 0,A",ot(0,"a")],b[200]=["SET 1,B",ot(1,"b")],b[201]=["SET 1,C",ot(1,"c")],b[202]=["SET 1,D",ot(1,"d")],b[203]=["SET 1,E",ot(1,"e")],b[204]=["SET 1,H",ot(1,"h")],b[205]=["SET 1,L",ot(1,"l")],b[207]=["SET 1,A",ot(1,"a")],b[208]=["SET 2,B",ot(2,"b")],b[209]=["SET 2,C",ot(2,"c")],b[210]=["SET 2,D",ot(2,"d")],b[211]=["SET 2,E",ot(2,"e")],b[212]=["SET 2,H",ot(2,"h")],b[213]=["SET 2,L",ot(2,"l")],b[215]=["SET 2,A",ot(2,"a")],b[216]=["SET 3,B",ot(3,"b")],b[217]=["SET 3,C",ot(3,"c")],b[218]=["SET 3,D",ot(3,"d")],b[219]=["SET 3,E",ot(3,"e")],b[220]=["SET 3,H",ot(3,"h")],b[221]=["SET 3,L",ot(3,"l")],b[223]=["SET 3,A",ot(3,"a")],b[224]=["SET 4,B",ot(4,"b")],b[225]=["SET 4,C",ot(4,"c")],b[226]=["SET 4,D",ot(4,"d")],b[227]=["SET 4,E",ot(4,"e")],b[228]=["SET 4,H",ot(4,"h")],b[229]=["SET 4,L",ot(4,"l")],b[231]=["SET 4,A",ot(4,"a")],b[232]=["SET 5,B",ot(5,"b")],b[233]=["SET 5,C",ot(5,"c")],b[234]=["SET 5,D",ot(5,"d")],b[235]=["SET 5,E",ot(5,"e")],b[236]=["SET 5,H",ot(5,"h")],b[237]=["SET 5,L",ot(5,"l")],b[239]=["SET 5,A",ot(5,"a")],b[240]=["SET 6,B",ot(6,"b")],b[241]=["SET 6,C",ot(6,"c")],b[242]=["SET 6,D",ot(6,"d")],b[243]=["SET 6,E",ot(6,"e")],b[244]=["SET 6,H",ot(6,"h")],b[245]=["SET 6,L",ot(6,"l")],b[247]=["SET 6,A",ot(6,"a")],b[248]=["SET 7,B",ot(7,"b")],b[249]=["SET 7,C",ot(7,"c")],b[250]=["SET 7,D",ot(7,"d")],b[251]=["SET 7,E",ot(7,"e")],b[252]=["SET 7,H",ot(7,"h")],b[253]=["SET 7,L",ot(7,"l")],b[255]=["SET 7,A",ot(7,"a")];var ht=function(t){return function(e,r){return r.writeByte(e.hl,r.readByte(e.hl)|1<<t),e.pc+=2,16}};b[198]=["SET 0,(HL)",ht(0)],b[206]=["SET 1,(HL)",ht(1)],b[214]=["SET 2,(HL)",ht(2)],b[222]=["SET 3,(HL)",ht(3)],b[230]=["SET 4,(HL)",ht(4)],b[238]=["SET 5,(HL)",ht(5)],b[246]=["SET 6,(HL)",ht(6)],b[254]=["SET 7,(HL)",ht(7)];var ft=function(t,e){return function(r){return r[e]&=~(1<<t),r.pc+=2,8}};b[128]=["RES 0,B",ft(0,"b")],b[129]=["RES 0,C",ft(0,"c")],b[130]=["RES 0,D",ft(0,"d")],b[131]=["RES 0,E",ft(0,"e")],b[132]=["RES 0,H",ft(0,"h")],b[133]=["RES 0,L",ft(0,"l")],b[135]=["RES 0,A",ft(0,"a")],b[136]=["RES 1,B",ft(1,"b")],b[137]=["RES 1,C",ft(1,"c")],b[138]=["RES 1,D",ft(1,"d")],b[139]=["RES 1,E",ft(1,"e")],b[140]=["RES 1,H",ft(1,"h")],b[141]=["RES 1,L",ft(1,"l")],b[143]=["RES 1,A",ft(1,"a")],b[144]=["RES 2,B",ft(2,"b")],b[145]=["RES 2,C",ft(2,"c")],b[146]=["RES 2,D",ft(2,"d")],b[147]=["RES 2,E",ft(2,"e")],b[148]=["RES 2,H",ft(2,"h")],b[149]=["RES 2,L",ft(2,"l")],b[151]=["RES 2,A",ft(2,"a")],b[152]=["RES 3,B",ft(3,"b")],b[153]=["RES 3,C",ft(3,"c")],b[154]=["RES 3,D",ft(3,"d")],b[155]=["RES 3,E",ft(3,"e")],b[156]=["RES 3,H",ft(3,"h")],b[157]=["RES 3,L",ft(3,"l")],b[159]=["RES 3,A",ft(3,"a")],b[160]=["RES 4,B",ft(4,"b")],b[161]=["RES 4,C",ft(4,"c")],b[162]=["RES 4,D",ft(4,"d")],b[163]=["RES 4,E",ft(4,"e")],b[164]=["RES 4,H",ft(4,"h")],b[165]=["RES 4,L",ft(4,"l")],b[167]=["RES 4,A",ft(4,"a")],b[168]=["RES 5,B",ft(5,"b")],b[169]=["RES 5,C",ft(5,"c")],b[170]=["RES 5,D",ft(5,"d")],b[171]=["RES 5,E",ft(5,"e")],b[172]=["RES 5,H",ft(5,"h")],b[173]=["RES 5,L",ft(5,"l")],b[175]=["RES 5,A",ft(5,"a")],b[176]=["RES 6,B",ft(6,"b")],b[177]=["RES 6,C",ft(6,"c")],b[178]=["RES 6,D",ft(6,"d")],b[179]=["RES 6,E",ft(6,"e")],b[180]=["RES 6,H",ft(6,"h")],b[181]=["RES 6,L",ft(6,"l")],b[183]=["RES 6,A",ft(6,"a")],b[184]=["RES 7,B",ft(7,"b")],b[185]=["RES 7,C",ft(7,"c")],b[186]=["RES 7,D",ft(7,"d")],b[187]=["RES 7,E",ft(7,"e")],b[188]=["RES 7,H",ft(7,"h")],b[189]=["RES 7,L",ft(7,"l")],b[191]=["RES 7,A",ft(7,"a")];var lt=function(t){return function(e,r){return r.writeByte(e.hl,r.readByte(e.hl)&~(1<<t)),e.pc+=2,16}};b[134]=["RES 0,(HL)",lt(0)],b[142]=["RES 1,(HL)",lt(1)],b[150]=["RES 2,(HL)",lt(2)],b[158]=["RES 3,(HL)",lt(3)],b[166]=["RES 4,(HL)",lt(4)],b[174]=["RES 5,(HL)",lt(5)],b[182]=["RES 6,(HL)",lt(6)],b[190]=["RES 7,(HL)",lt(7)],S[195]=["JP nn",function(t,e){return t.pc=e.readWord(t.pc+1),16}];var _t=function(t,e,r){return r?(t.pc=e.readWord(t.pc+1),16):(t.pc+=3,12)};S[194]=["JP NZ,nn",function(t,e){return _t(t,e,!(t.f&D))}],S[210]=["JP NC,nn",function(t,e){return _t(t,e,!(t.f&T))}],S[202]=["JP Z,nn",function(t,e){return _t(t,e,t.f&D)}],S[218]=["JP C,nn",function(t,e){return _t(t,e,t.f&T)}],S[233]=["JP (HL)",function(t){return t.pc=t.hl,4}],S[24]=["JR n",function(t,e){return t.pc+=2+e.readByte(t.pc+1).signed(),12}];var pt=function(t,e,r){return r?(t.pc+=2+e.readByte(t.pc+1).signed(),12):(t.pc+=2,8)};S[32]=["JR NZ,n",function(t,e){return pt(t,e,!(t.f&D))}],S[48]=["JR NC,n",function(t,e){return pt(t,e,!(t.f&T))}],S[40]=["JR Z,n",function(t,e){return pt(t,e,t.f&D)}],S[56]=["JR C,n",function(t,e){return pt(t,e,t.f&T)}],S[205]=["CALL nn",function(t,e){return e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24}];var dt=function(t,e,r){return r?(e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24):(t.pc+=3,12)};S[196]=["CALL NZ,nn",function(t,e){return dt(t,e,!(t.f&D))}],S[212]=["CALL NC,nn",function(t,e){return dt(t,e,!(t.f&T))}],S[204]=["CALL Z,nn",function(t,e){return dt(t,e,t.f&D)}],S[220]=["CALL C,nn",function(t,e){return dt(t,e,t.f&T)}];var yt=function(t){return function(e,r){return r.writeWord(e.sp-=2,e.pc+1),e.pc=t,16}};S[199]=["RST 00H",yt(0)],S[207]=["RST 08H",yt(8)],S[215]=["RST 10H",yt(16)],S[223]=["RST 18H",yt(24)],S[231]=["RST 20H",yt(32)],S[239]=["RST 28H",yt(40)],S[247]=["RST 30H",yt(48)],S[255]=["RST 38H",yt(56)],S[201]=["RET",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,16}];var vt=function(t,e,r){return r?(t.pc=e.readWord(t.sp),t.sp+=2,20):(t.pc+=1,8)};S[192]=["RET NZ",function(t,e){return vt(t,e,!(t.f&D))}],S[208]=["RET NC",function(t,e){return vt(t,e,!(t.f&T))}],S[200]=["RET Z",function(t,e){return vt(t,e,t.f&D)}],S[216]=["RET C",function(t,e){return vt(t,e,t.f&T)}],S[217]=["RETI",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,t.ime=!0,16}]},{"../util/number":15}],3:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:timer:step"),u=t("debug")("gameboy:timer:divider"),a=t("debug")("gameboy:timer:counter"),c=t("../registers"),o=c.DIV,h=c.TIMA,f=c.TMA,l=c.TAC,_=t("../interrupts"),p=_.INT_50,d=16384,y=[];y[0]=4096,y[1]=262144,y[2]=65536,y[3]=16384;var v=function(){function t(e){n(this,t),this._mmu=e,this._div=0,this._tima=0,this._tma=0,this._tac=0,this._divider=d,this._t=y[0]}return i(t,[{key:"init",value:function(){this._div=0,this._tima=0,this._tma=0,this._tac=0,this._divider=d,this._t=y[0]}},{key:"step",value:function(t){s("%d",t),this._divider-=t,this._divider<=0&&(this._div=255&++this._div,u("0x%s",this._div.toString(16)),this._divider+=d),0!=(4&this._tac)&&(this._t-=t,this._t>0||(this._tima=255&++this._tima,0==this._tima&&(this._tima=this._tma,this._mmu.if|=p),a("0x%s",this._tima.toString(16)),this._t+=y[3&this._tac]))}},{key:"readByte",value:function(t){switch(t){case o:return this._div;case h:return this._tima;case f:return this._tma;case l:return this._tac}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case o:return this._div=0;case h:return this._tima=e;case f:return this._tma=e;case l:return this._tac=e}throw new Error("unmapped address 0x"+t.toString(16))}}]),t}();e.exports=v},{"../interrupts":8,"../registers":12,debug:14}],4:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("./gpu/video"),u=t("./cpu/timer"),a=t("./gpu/lcd"),c=t("./mmu"),o=t("./gpu/gpu"),h=t("./cpu/cpu"),f=t("./io/joypad"),l=t("./io/cart"),_=function(){function t(e){n(this,t);var r=new c(e),i=new s,l=new o(i),_=new u(r),p=new a(r,l),d=new h(r,_,p),y=new f(r);this._timer=_,this._lcd=p,this._mmu=r,this._gpu=l,this._cpu=d,this._joypad=y,r.video=i,r.timer=_,r.lcd=p,r.gpu=l,r.joypad=y,this._useBios=e&&e.length>0,this._isRunning=!0}return i(t,[{key:"loadCart",value:function(t){this._isRunning=!1,this._cpu.stop(),this._mmu.loadCart(new l(t))}},{key:"start",value:function(){this._isRunning=!0,this._init(),this._cpu.start()}},{key:"pauseResume",value:function(){this._isRunning=!this._isRunning,this._isRunning?this._cpu.start():this._cpu.stop()}},{key:"reset",value:function(){this._isRunning=!1,this._cpu.stop(),this.start()}},{key:"_init",value:function(){this._timer.init(),this._lcd.init(),this._mmu.init(),this._cpu.init(),this._useBios||(this._cpu.pc=256,this._cpu.af=432,this._cpu.bc=19,this._cpu.de=216,this._cpu.hl=333,this._cpu.sp=65534,this._mmu.writeByte(65285,0),this._mmu.writeByte(65286,0),this._mmu.writeByte(65287,0),this._mmu.writeByte(65296,128),this._mmu.writeByte(65297,191),this._mmu.writeByte(65298,243),this._mmu.writeByte(65300,191),this._mmu.writeByte(65302,63),this._mmu.writeByte(65303,0),this._mmu.writeByte(65305,191),this._mmu.writeByte(65306,127),this._mmu.writeByte(65307,255),this._mmu.writeByte(65308,159),this._mmu.writeByte(65310,191),this._mmu.writeByte(65312,255),this._mmu.writeByte(65313,0),this._mmu.writeByte(65314,0),this._mmu.writeByte(65315,191),this._mmu.writeByte(65316,119),this._mmu.writeByte(65317,243),this._mmu.writeByte(65318,241),this._mmu.writeByte(65344,145),this._mmu.writeByte(65346,0),this._mmu.writeByte(65347,0),this._mmu.writeByte(65349,0),this._mmu.writeByte(65351,252),this._mmu.writeByte(65352,255),this._mmu.writeByte(65353,255),this._mmu.writeByte(65354,0),this._mmu.writeByte(65355,0),this._mmu.writeByte(65535,0))}},{key:"gpu",get:function(){return this._gpu}},{key:"joypad",get:function(){return this._joypad}}]),t}();e.exports=_},{"./cpu/cpu":1,"./cpu/timer":3,"./gpu/gpu":5,"./gpu/lcd":6,"./gpu/video":7,"./io/cart":9,"./io/joypad":10,"./mmu":11}],5:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e);
}var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("debug")("gameboy:gpu:render"),c=t("debug")("gameboy:gpu:control"),o=t("events").EventEmitter,h=t("../shims/canvas"),f=t("../registers"),l=f.LCDC,_=f.SCY,p=f.SCX,d=f.WY,y=f.WX,v=f.BGP,m=f.OBP0,L=f.OBP1;t("../util/number");var B=[];B[0]=[255,255,255],B[1]=[192,192,192],B[2]=[96,96,96],B[3]=[0,0,0];var E=160,w=144,S=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t,r._lcdc=0,r._scy=0,r._scx=0,r._wy=0,r._wx=0,r._bgp=0,r._obp0=0,r._obp1=0,r._bgpal=null,r._objpal=[],r._canvas=new h(E,w),r._ctx=r._canvas.getContext("2d"),r._image=r._ctx.getImageData(0,0,E,w),r._data=r._image.data,r}return s(e,t),u(e,[{key:"readByte",value:function(t){switch(t){case l:return this._lcdc;case _:return this._scy;case p:return this._scx;case v:return this._bgp;case m:return this._obp0;case L:return this._obp1;case d:return this._wy;case y:return this._wx}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case l:return this._lcdc=e;case _:return this._scy=e;case p:return this._scx=e;case v:return this._bgpal=this._createPalette(e),this._bgp=e;case m:return this._objpal[0]=this._createPalette(e),this._obp0=e;case L:return this._objpal[1]=this._createPalette(e),this._obp1=e;case d:return this._wy=e;case y:return this._wx=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"drawLine",value:function(t){var e=this._lcdc>>4&1;if(1&this._lcdc){var r=this._lcdc>>3&1;this._drawBackground(t,this._scx,this._scy,r,e)}if(32&this._lcdc&&t>=this._wy){var n=this._lcdc>>6&1;this._drawWindow(t,this._wx-7,this._wy,n,e)}2&this._lcdc&&this._drawSprites(t)}},{key:"render",value:function(){a("frame"),c("%s",this._lcdc.toString(2)),this._lcdc&!1&&(this._ctx.fillStyle="white",this._ctx.fillRect(0,0,E,w)),this._ctx.putImageData(this._image,0,0),this._ctx.drawImage(this._canvas,0,0),this.emit("frame",this._canvas)}},{key:"_createPalette",value:function(t){return[B[3&t],B[t>>2&3],B[t>>4&3],B[t>>6&3]]}},{key:"_drawBackground",value:function(t,e,r,n,i){for(var s=this._video.bgMap[n],u=r+t,a=0;a<E;a++){var c=e+a,o=(255&c)>>3,h=(255&u)>>3,f=s[32*h+o],l=this._video.tiles[i?f:256+f.signed()],_=this._bgpal[l[7&u][7&c]],p=4*(t*E+a);this._data[p]=_[0],this._data[++p]=_[1],this._data[++p]=_[2],this._data[++p]=255}}},{key:"_drawWindow",value:function(t,e,r,n,i){for(var s=this._video.bgMap[n],u=t-r,a=e;a<E;a++){var c=a-e,o=c>>3,h=u>>3,f=s[32*h+o],l=this._video.tiles[i?f:256+f.signed()],_=this._bgpal[l[7&u][7&c]],p=4*(t*E+a);this._data[p]=_[0],this._data[++p]=_[1],this._data[++p]=_[2],this._data[++p]=255}}},{key:"_drawSprites",value:function(t){for(var e=4&this._lcdc?16:8,r=this._video.sprites.slice().sort(function(t,e){return t[1]-e[1]}),n=r.length-1;n>-1;n--){var i=r[n],s=i[0]-16,u=i[1]-8;if(t>=s&&t<s+e&&!(u>=E))for(var a=4&this._lcdc?254&i[2]:i[2],c=i[3],o=c>>7&1,h=c>>6&1,f=c>>5&1,l=this._objpal[c>>4&1],_=h?e-1-(t-s):t-s,p=this._data,d=u;d<u+8&&d<E;d++)if(!(d<0)){var y=4*(t*E+d);if(!o||255==p[y+0]||255==p[y+1]||255==p[y+2]){var v=this._video.tiles[a+(_>>3&1)],m=v[7&_][f?7-(d-u):d-u];if(0!=m){var L=l[m];p[y+0]=L[0],p[y+1]=L[1],p[y+2]=L[2],p[y+3]=255}}}}}}]),e}(o);e.exports=S},{"../registers":12,"../shims/canvas":13,"../util/number":15,debug:14,events:17}],6:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:lcd:step"),u=t("debug")("gameboy:lcd:stat"),a=t("../registers"),c=a.STAT,o=a.LY,h=a.LYC,f=t("../interrupts"),l=f.INT_40,_=f.INT_48,p=function(){function t(e,r){n(this,t),this._mmu=e,this._gpu=r,this._stat=0,this._ly=0,this._lyc=0,this._t=0}return i(t,[{key:"init",value:function(){this._stat=0,this._ly=0,this._lyc=0,this._t=0}},{key:"step",value:function(t){s("%d",t),this._t+=t;var e=3&this._stat;switch(e){case 2:this._t>=80&&(this._t-=80,this._changeMode(3));break;case 3:this._t>=172&&(this._t-=172,this._changeMode(0),this._gpu.drawLine(this._ly));break;case 0:this._t>=204&&(this._t-=204,this._ly++,this._checkCoincidence(),144==this._ly?(this._changeMode(1),this._mmu.if|=l,this._gpu.render()):this._changeMode(2));break;case 1:this._t>=456&&(this._t-=456,this._ly++,this._ly>153&&(this._ly=0,this._changeMode(2)),this._checkCoincidence())}u("mode=%d; ly=%d",3&this._stat,this._ly)}},{key:"readByte",value:function(t){switch(t){case c:return this._stat;case o:return this._ly;case h:return this._lyc}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case c:return this._stat=this._stat&-121|248&e;case o:return this._ly=0;case h:return this._lyc=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_changeMode",value:function(t){var e=!1;switch(t){case 0:8&this._stat&&(e=!0);break;case 1:16&this._stat&&(e=!0);break;case 2:32&this._stat&&(e=!0)}e&&(this._mmu.if|=_),this._stat=this._stat&-4|t}},{key:"_checkCoincidence",value:function(){this._lyc==this._ly?(this._stat|=4,64&this._stat&&(this._mmu.if|=_)):this._stat&=-5}}]),t}();e.exports=p},{"../interrupts":8,"../registers":12,debug:14}],7:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:video:dma"),u=function(){function t(){n(this,t),this._ram=new Uint8Array(8192),this._oam=new Uint8Array(160),this.bgMap=[new Array(1024).fill(0),new Array(1024).fill(0)],this.tiles=this._initTiles(1024),this.sprites=this._initSprites(40)}return i(t,[{key:"transfer",value:function(t,e){var r=(255&e)<<8;s("transfer from 0x%s",r.toString(16));for(var n=r;n<r+160;n++){var i=t.readByte(n),u=255&n;s("copy $%s = 0x%s",n.toString(16),i.toString(16)),this.sprites[u>>2][3&u]=i,this._oam[u]=i}}},{key:"readByte",value:function(t){switch(t>>12){case 8:case 9:return this._ram[8191&t];case 15:if(t>65183)break;if(t>65023)return this._oam[255&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 8:case 9:if(t>38911)this.bgMap[t>>10&1][1023&t]=e;else{var r=8191&t,n=this._sumBytes(this._ram[r-1],e);this.tiles[r>>4][r>>1&7]=n}return this._ram[8191&t]=e;case 15:if(t>65183)break;if(t>65023){var i=255&t;return this.sprites[i>>2][3&i]=e,this._oam[i]=e}}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_initTiles",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]];return e}},{key:"_initSprites",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[0,0,0,0];return e}},{key:"_sumBytes",value:function(t,e){for(var r=[],n=7;n>-1;n--){var i=t>>n&1|(e>>n&1)<<1;r[7-n]=i}return r}}]),t}();e.exports=u},{debug:14}],8:[function(t,e,r){"use strict";r.INT_40=1,r.INT_48=2,r.INT_50=4,r.INT_58=8,r.INT_60=16},{}],9:[function(t,e,r){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=[];u[0]="ROM ONLY",u[1]="MBC1",u[2]="MBC1+RAM",u[3]="MBC1+RAM+BATTERY",u[5]="MBC2",u[6]="MBC2+BATTERY";var a=[];a[0]=1,a[1]=2,a[2]=4,a[3]=8,a[4]=16;var c=[];c[0]=0,c[1]=1,c[2]=4,c[3]=16;var o=function(){function t(e){i(this,t);var r=new Uint8Array(e);this._title=this._sliceToString(r,308,323),this._type=r[327],this._romSize=r[328],this._ramSize=r[329],this._rom=new Uint8Array(r,0,32768*a[this._romSize]),this._ram=new Uint8Array(8192*c[this._ramSize]),this._romBank=1,this._ramBank=0,this._ramEnabled=!1,this._mode=0}return s(t,[{key:"readByte",value:function(t){switch(t>>12){case 0:case 1:case 2:case 3:return this._rom[t];case 4:case 5:case 6:case 7:var e=16383&t;return this._rom[16384*this._romBank+e];case 10:case 11:var r=8191&t;return this._ram[8192*this._ramBank+r]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 0:case 1:return this._ramEnabled=10==(15&e);case 2:case 3:e&=31,0==(31&e)&&(e|=1);var r=96&this._romBank|e,n=r&2*a[this._romSize]-1;return this._romBank=n;case 4:case 5:if(e&=3,1==this._mode)return this._ramBank=e;var i=31&this._romBank|e<<5,s=i&2*a[this._romSize]-1;return this._romBank=s;case 6:case 7:return this._mode=1&e;case 10:case 11:if(!this._ramEnabled)return;var u=8191&t;return this._ram[8192*this._ramBank+u]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"toJSON",value:function(){return{title:this._title,type:u[this._type],romSize:this._romSize,ramSize:this._ramSize}}},{key:"_sliceToString",value:function(t,e,r){return String.fromCharCode.apply(String,n(t.slice(e,r))).replace(/\0/g,"")}}]),t}();e.exports=o},{}],10:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:joypad"),u=t("../registers"),a=u.JOYP,c=t("../interrupts"),o=c.INT_60,h=function(){function t(e){n(this,t),this._mmu=e,this._keys={},this._select=0,this._joyp=[15,15]}return i(t,[{key:"keyDown",value:function(t){s("keydown %d",t),this._keys[t]=!0,this._update()}},{key:"keyUp",value:function(t){s("keyup %d",t),this._keys[t]=!1,this._update()}},{key:"readByte",value:function(t){if(t==a)return this._joyp[this._select];throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){if(t==a){switch(48&e){case 16:this._select=0;break;case 32:this._select=1}return this._joyp[this._select]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_update",value:function(){this._joyp=[15,15],this._keys[40]&&(this._joyp[1]&=-9),this._keys[13]&&(this._joyp[0]&=-9),this._keys[38]&&(this._joyp[1]&=-5),this._keys[16]&&(this._joyp[0]&=-5),this._keys[37]&&(this._joyp[1]&=-3),this._keys[90]&&(this._joyp[0]&=-3),this._keys[39]&&(this._joyp[1]&=-2),this._keys[88]&&(this._joyp[0]&=-2),this._mmu.if|=o}}]),t}();e.exports=h},{"../interrupts":8,"../registers":12,debug:14}],11:[function(t,e,r){(function(r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=t("debug")("gameboy:mmu:read"),u=t("debug")("gameboy:mmu:write"),a=t("./registers"),c=a.IF,o=a.IE,h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,t),this._bios=new Uint8Array(e),this._biosDisabled=0==this._bios.length,this.video=null,this.timer=null,this.lcd=null,this.gpu=null,this.joypad=null,this._wram=new Uint8Array(8192),this._io=new Uint8Array(128),this._zram=new Uint8Array(127),this._cart=null,this.if=0,this.ie=0}return i(t,[{key:"init",value:function(){this._biosDisabled=0==this._bios.length,this.if=0,this.ie=0}},{key:"loadCart",value:function(t){this._cart=t}},{key:"readByte",value:function(t){switch(t&=65535,s("$%s",t.toString(16)),t>>12){case 0:if(!this._biosDisabled&&t<256)return this._bios[t];case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.readByte(t);case 8:case 9:return this.video.readByte(t);case 12:case 13:return this._wram[8191&t];case 14:case 15:if(t==o)return this.ie;if(t==c)return this.if;if(t>65407)return this._zram[127&t];if(t>65279){switch(255&t){case 0:return this.joypad.readByte(t);case 4:case 5:case 6:case 7:return this.timer.readByte(t);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.readByte(t);case 65:case 68:case 69:return this.lcd.readByte(t)}return this._io[255&t]}return t>65183?0:t>65023?this.video.readByte(t):this._wram[8191&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"readWord",value:function(t){return this.readByte(t)|this.readByte(t+1)<<8}},{key:"writeByte",value:function(t,e){if(t&=65535,e&=255,u("$%s = 0x%s",t.toString(16),e.toString(16)),r&&r.env.TEST_ROM&&65282==t&&129==e){var n=String.fromCharCode(this.readByte(65281));r.stdout.write(n)}switch(t>>12){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.writeByte(t,e);case 8:case 9:return this.video.writeByte(t,e);case 12:case 13:return this._wram[8191&t]=e;case 14:case 15:if(t==o)return this.ie=e;if(t==c)return this.if=e;if(t>65407)return this._zram[127&t]=e;if(t>65279){switch(255&t){case 0:return this.joypad.writeByte(t,e);case 4:case 5:case 6:case 7:return this.timer.writeByte(t,e);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.writeByte(t,e);case 65:case 68:case 69:return this.lcd.writeByte(t,e);case 70:this.video.transfer(this,e);break;case 80:this._biosDisabled=!0}return this._io[255&t]=e}if(t>65183)return;return t>65023?this.video.writeByte(t,e):this._wram[8191&t]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeWord",value:function(t,e){this.writeByte(t,e),this.writeByte(t+1,e>>8)}}]),t}();e.exports=h}).call(this,t("_process"))},{"./registers":12,_process:19,debug:14}],12:[function(t,e,r){"use strict";r.JOYP=65280,r.DIV=65284,r.TIMA=65285,r.TMA=65286,r.TAC=65287,r.IF=65295,r.LCDC=65344,r.STAT=65345,r.SCY=65346,r.SCX=65347,r.LY=65348,r.LYC=65349,r.DMA=65350,r.BGP=65351,r.OBP0=65352,r.OBP1=65353,r.WY=65354,r.WX=65355,r.IE=65535},{}],13:[function(t,e,r){"use strict";function n(e,r){if("undefined"!=typeof window){var n=document.createElement("canvas");return n.width=e,n.height=r,n}return new(t("canvas"))(e,r)}e.exports=n},{canvas:16}],14:[function(t,e,r){"use strict";e.exports=function(){return function(){}}},{}],15:[function(t,e,r){"use strict";Number.prototype.signed=function(){return 128&this?-((255&~this)+1):this}},{}],16:[function(t,e,r){"use strict"},{}],17:[function(t,e,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function s(t){return"number"==typeof t}function u(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!s(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,r,n,s,c,o;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(r=this._events[t],a(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(u(r))for(s=Array.prototype.slice.call(arguments,1),o=r.slice(),n=o.length,c=0;c<n;c++)o[c].apply(this,s);return!0},n.prototype.addListener=function(t,e){var r;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?u(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,u(this._events[t])&&!this._events[t].warned&&(r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function r(){this.removeListener(t,r),n||(n=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var n=!1;return r.listener=e,this.on(t,r),this},n.prototype.removeListener=function(t,e){var r,n,s,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],s=r.length,n=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(u(r)){for(a=s;a-- >0;)if(r[a]===e||r[a].listener&&r[a].listener===e){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],i(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],18:[function(t,e,r){(function(t){(function(){var r,n,i;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:"undefined"!=typeof t&&null!==t&&t.hrtime?(e.exports=function(){return(r()-i)/1e6},n=t.hrtime,r=function(){var t;return t=n(),1e9*t[0]+t[1]},i=r()):Date.now?(e.exports=function(){return Date.now()-i},i=Date.now()):(e.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)}).call(this,t("_process"))},{_process:19}],19:[function(t,e,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function u(t){if(l===clearTimeout)return clearTimeout(t);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function a(){y&&p&&(y=!1,p.length?d=p.concat(d):v=-1,d.length&&c())}function c(){if(!y){var t=s(a);y=!0;for(var e=d.length;e;){for(p=d,d=[];++v<e;)p&&p[v].run();v=-1,e=d.length}p=null,y=!1,u(t)}}function o(t,e){this.fun=t,this.array=e}function h(){}var f,l,_=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(t){l=i}}();var p,d=[],y=!1,v=-1;_.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];d.push(new o(t,e)),1!==d.length||y||s(c)},o.prototype.run=function(){this.fun.apply(null,this.array)},_.title="browser",_.browser=!0,_.env={},_.argv=[],_.version="",_.versions={},_.on=h,_.addListener=h,_.once=h,_.off=h,_.removeListener=h,_.removeAllListeners=h,_.emit=h,_.binding=function(t){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(t){throw new Error("process.chdir is not supported")},_.umask=function(){return 0}},{}],20:[function(t,e,r){(function(r){for(var n=t("performance-now"),i="undefined"==typeof window?r:window,s=["moz","webkit"],u="AnimationFrame",a=i["request"+u],c=i["cancel"+u]||i["cancelRequest"+u],o=0;!a&&o<s.length;o++)a=i[s[o]+"Request"+u],c=i[s[o]+"Cancel"+u]||i[s[o]+"CancelRequest"+u];if(!a||!c){var h=0,f=0,l=[],_=1e3/60;a=function(t){if(0===l.length){var e=n(),r=Math.max(0,_-(e-h));h=r+e,setTimeout(function(){var t=l.slice(0);l.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(h)}catch(t){setTimeout(function(){throw t},0)}},Math.round(r))}return l.push({handle:++f,callback:t,cancelled:!1}),f},c=function(t){for(var e=0;e<l.length;e++)l[e].handle===t&&(l[e].cancelled=!0)}}e.exports=function(t){return a.call(i,t)},e.exports.cancel=function(){c.apply(i,arguments)},e.exports.polyfill=function(){i.requestAnimationFrame=a,i.cancelAnimationFrame=c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":18}]},{},[4])(4)});
